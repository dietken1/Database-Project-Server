# ë“œë¡  ë°°ì†¡ ê´€ë¦¬ ì‹œìŠ¤í…œ - í”„ë¡œì íŠ¸ ìƒì„¸ ë¬¸ì„œ

## ğŸ“‘ ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ê°œìš”](#1-í”„ë¡œì íŠ¸-ê°œìš”)
2. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#2-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
3. [ê¸°ìˆ  ìŠ¤íƒ ë° ì„ íƒ ì´ìœ ](#3-ê¸°ìˆ -ìŠ¤íƒ-ë°-ì„ íƒ-ì´ìœ )
4. [ë„ë©”ì¸ ëª¨ë¸ ì„¤ê³„](#4-ë„ë©”ì¸-ëª¨ë¸-ì„¤ê³„)
5. [í•µì‹¬ ê¸°ëŠ¥ ìƒì„¸](#5-í•µì‹¬-ê¸°ëŠ¥-ìƒì„¸)
6. [API ëª…ì„¸](#6-api-ëª…ì„¸)
7. [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„](#7-ë°ì´í„°ë² ì´ìŠ¤-ì„¤ê³„)
8. [ì‹¤ì‹œê°„ í†µì‹  êµ¬ì¡°](#8-ì‹¤ì‹œê°„-í†µì‹ -êµ¬ì¡°)
9. [ë°°ì¹˜ ì²˜ë¦¬ ë° ìŠ¤ì¼€ì¤„ë§](#9-ë°°ì¹˜-ì²˜ë¦¬-ë°-ìŠ¤ì¼€ì¤„ë§)
10. [ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ](#10-ì—ëŸ¬-ì²˜ë¦¬-ì „ëµ)
11. [ì„±ëŠ¥ ìµœì í™”](#11-ì„±ëŠ¥-ìµœì í™”)
12. [ë³´ì•ˆ ê³ ë ¤ì‚¬í•­](#12-ë³´ì•ˆ-ê³ ë ¤ì‚¬í•­)
13. [í…ŒìŠ¤íŠ¸ ì „ëµ](#13-í…ŒìŠ¤íŠ¸-ì „ëµ)
14. [ë°°í¬ ê°€ì´ë“œ](#14-ë°°í¬-ê°€ì´ë“œ)

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1.1 í”„ë¡œì íŠ¸ ëª©ì 

ë³¸ í”„ë¡œì íŠ¸ëŠ” **ì‚¬ìš©ì ìœ„ì¹˜ ê¸°ë°˜ ë“œë¡  ë°°ì†¡ ì„œë¹„ìŠ¤**ì˜ ë°±ì—”ë“œ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ë°ëª¨ ì‹œì—°ì„ ëª©ì ìœ¼ë¡œ í•˜ë©°, ë‹¤ìŒê³¼ ê°™ì€ ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤:

- ì‚¬ìš©ìê°€ ìì‹ ì˜ ìœ„ì¹˜ì—ì„œ ì£¼ë³€ í¸ì˜ì /ì•½êµ­ì„ ì°¾ìŒ
- ì›í•˜ëŠ” ë§¤ì¥ì˜ ìƒí’ˆì„ ì¹´í…Œê³ ë¦¬ë³„ë¡œ íƒìƒ‰í•˜ê³  ì£¼ë¬¸
- ì‹œìŠ¤í…œì´ 10ë¶„ ë‹¨ìœ„ë¡œ ì£¼ë¬¸ì„ ëª¨ì•„ ìµœì ì˜ ë°°ì†¡ ê²½ë¡œ ê³„ì‚°
- ë“œë¡ ì´ ë§¤ì¥ì—ì„œ ì¶œë°œí•˜ì—¬ ì—¬ëŸ¬ ê³ ê°ì—ê²Œ ìˆœì°¨ ë°°ì†¡ í›„ ë³µê·€
- ì‚¬ìš©ìê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë“œë¡ ì˜ ìœ„ì¹˜ë¥¼ ì¶”ì 

### 1.2 ì£¼ìš” íŠ¹ì§•

#### âœ¨ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
- **ìœ„ì¹˜ ê¸°ë°˜ ì„œë¹„ìŠ¤**: Haversine ê³µì‹ì„ ì´ìš©í•œ ì •í™•í•œ ê±°ë¦¬ ê³„ì‚°
- **ê²½ë¡œ ìµœì í™”**: TSP(Traveling Salesman Problem) ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ìµœë‹¨ ê²½ë¡œ íƒìƒ‰
- **ì¬ê³  ê´€ë¦¬**: ì‹¤ì‹œê°„ ì¬ê³  í™•ì¸ ë° ì°¨ê°
- **ë°°ì¹˜ ì²˜ë¦¬**: 10ë¶„ ë‹¨ìœ„ë¡œ ì£¼ë¬¸ì„ ë¬¶ì–´ íš¨ìœ¨ì ì¸ ë°°ì†¡

#### ğŸ—ï¸ ì•„í‚¤í…ì²˜
- **ë„ë©”ì¸ ì¤‘ì‹¬ ì„¤ê³„**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë„ë©”ì¸ë³„ë¡œ ëª…í™•íˆ ë¶„ë¦¬
- **ë ˆì´ì–´ë“œ ì•„í‚¤í…ì²˜**: Controller â†’ Service â†’ Repository ê³„ì¸µ êµ¬ì¡°
- **ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬**: ì¼ê´€ëœ ì—ëŸ¬ ì‘ë‹µ ë° ë¡œê¹…
- **í‘œì¤€í™”ëœ API**: BaseResponseë¥¼ í†µí•œ í†µì¼ëœ ì‘ë‹µ í˜•ì‹

#### ğŸ”„ ì‹¤ì‹œê°„ ê¸°ëŠ¥
- **WebSocket í†µì‹ **: STOMP í”„ë¡œí† ì½œì„ ì´ìš©í•œ ì–‘ë°©í–¥ í†µì‹ 
- **ë“œë¡  ì‹œë®¬ë ˆì´í„°**: ì‹¤ì œ ë¹„í–‰ì„ ì‹œë®¬ë ˆì´ì…˜í•˜ì—¬ 2ì´ˆë§ˆë‹¤ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
- **ë¹„ë™ê¸° ì²˜ë¦¬**: Spring @Asyncë¥¼ í†µí•œ ë…¼ë¸”ë¡œí‚¹ ì‘ì—…

### 1.3 ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

| í•­ëª© | ëª©í‘œ |
|------|------|
| **ì‘ë‹µ ì‹œê°„** | í‰ê·  200ms ì´í•˜ (ì¡°íšŒ API) |
| **ë™ì‹œ ì ‘ì†** | 100+ WebSocket ì—°ê²° ì§€ì› |
| **ë°ì´í„° ì •í™•ë„** | ìœ„ê²½ë„ ì†Œìˆ˜ì  6ìë¦¬ (Â±0.11m) |
| **ë°°ì¹˜ ì²˜ë¦¬** | 10ë¶„ë§ˆë‹¤ ì•ˆì •ì  ì‹¤í–‰ |
| **API ë¬¸ì„œ** | 100% Swagger ì»¤ë²„ë¦¬ì§€ |

---

## 2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 2.1 ì „ì²´ êµ¬ì¡°ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        í´ë¼ì´ì–¸íŠ¸                              â”‚
â”‚                    (React Frontend)                          â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ë„¤ì´ë²„ ì§€ë„   â”‚  â”‚  ì£¼ë¬¸ UI     â”‚  â”‚ ì‹¤ì‹œê°„ ì¶”ì    â”‚      â”‚
â”‚  â”‚   API ì—°ë™    â”‚  â”‚              â”‚  â”‚  (WebSocket) â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ HTTP/WebSocket
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Spring Boot Backend                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              Global Layer                          â”‚     â”‚
â”‚  â”‚  - CORS Config                                     â”‚     â”‚
â”‚  â”‚  - Swagger Config                                  â”‚     â”‚
â”‚  â”‚  - WebSocket Config                                â”‚     â”‚
â”‚  â”‚  - Global Exception Handler                        â”‚     â”‚
â”‚  â”‚  - BaseResponse / ErrorCode                        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Controller Layer                       â”‚    â”‚
â”‚  â”‚  StoreController â”‚ OrderController â”‚ RouteControllerâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Service Layer                          â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ StoreService â”‚  â”‚ OrderService â”‚  â”‚RouteServiceâ”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚        Route Domain Services               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  - RouteOptimizerService (TSP)             â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  - DroneSimulatorService (@Async)          â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  - DeliveryBatchService                    â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Repository Layer (JPA)                 â”‚    â”‚
â”‚  â”‚  StoreRepo â”‚ OrderRepo â”‚ RouteRepo â”‚ DroneRepo ... â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Scheduler                              â”‚    â”‚
â”‚  â”‚  DeliveryScheduler (@Scheduled, cron: */10)         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ JDBC
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MySQL Database                          â”‚
â”‚                                                              â”‚
â”‚  Store â”‚ Product â”‚ User â”‚ Drone â”‚ Order                 â”‚
â”‚  Route â”‚ RouteStop â”‚ RoutePosition â”‚ FlightLog ...          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 íŒ¨í‚¤ì§€ êµ¬ì¡° (ë„ë©”ì¸ ì¤‘ì‹¬ ì„¤ê³„)

```
backend.databaseproject/
â”‚
â”œâ”€â”€ DroneDeliveryApplication.java    # ë©”ì¸ í´ë˜ìŠ¤ (@EnableAsync)
â”‚
â”œâ”€â”€ global/                           # ì „ì—­ ê³µí†µ ê¸°ëŠ¥
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”œâ”€â”€ BaseResponse.java        # í‘œì¤€ ì‘ë‹µ í¬ë§·
â”‚   â”‚   â”œâ”€â”€ BaseException.java       # ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸
â”‚   â”‚   â””â”€â”€ ErrorCode.java           # ì—ëŸ¬ ì½”ë“œ enum
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ SwaggerConfig.java       # OpenAPI ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ CorsConfig.java          # CORS í—ˆìš©
â”‚   â”‚   â”œâ”€â”€ WebSocketConfig.java     # STOMP ì„¤ì •
â”‚   â”‚   â””â”€â”€ SchedulerConfig.java     # @EnableScheduling
â”‚   â”œâ”€â”€ handler/
â”‚   â”‚   â””â”€â”€ GlobalExceptionHandler.java  # @RestControllerAdvice
â”‚   â””â”€â”€ util/
â”‚       â””â”€â”€ GeoUtils.java             # Haversine ê±°ë¦¬ ê³„ì‚°
â”‚
â””â”€â”€ domain/                           # ë„ë©”ì¸ë³„ êµ¬ì¡°
    â”œâ”€â”€ store/                        # ë§¤ì¥ ë„ë©”ì¸
    â”‚   â”œâ”€â”€ controller/
    â”‚   â”‚   â””â”€â”€ StoreController.java
    â”‚   â”œâ”€â”€ service/
    â”‚   â”‚   â””â”€â”€ StoreService.java
    â”‚   â”œâ”€â”€ repository/
    â”‚   â”‚   â”œâ”€â”€ StoreRepository.java
    â”‚   â”‚   â””â”€â”€ StoreProductRepository.java
    â”‚   â”œâ”€â”€ entity/
    â”‚   â”‚   â”œâ”€â”€ Store.java
    â”‚   â”‚   â”œâ”€â”€ StoreProduct.java
    â”‚   â”‚   â””â”€â”€ StoreType.java (enum)
    â”‚   â””â”€â”€ dto/
    â”‚       â””â”€â”€ response/
    â”‚           â”œâ”€â”€ StoreResponse.java
    â”‚           â”œâ”€â”€ CategoryResponse.java
    â”‚           â””â”€â”€ ProductResponse.java
    â”‚
    â”œâ”€â”€ product/                      # ìƒí’ˆ ë„ë©”ì¸
    â”‚   â”œâ”€â”€ entity/
    â”‚   â”‚   â””â”€â”€ Product.java
    â”‚   â””â”€â”€ repository/
    â”‚       â””â”€â”€ ProductRepository.java
    â”‚
    â”œâ”€â”€ user/                         # ì‚¬ìš©ì ë„ë©”ì¸
    â”‚   â”œâ”€â”€ controller/
    â”‚   â”‚   â””â”€â”€ UserController.java
    â”‚   â”œâ”€â”€ service/
    â”‚   â”‚   â””â”€â”€ UserService.java
    â”‚   â”œâ”€â”€ entity/
    â”‚   â”‚   â”œâ”€â”€ User.java
    â”‚   â”‚   â””â”€â”€ UserRole.java (enum)
    â”‚   â”œâ”€â”€ repository/
    â”‚   â”‚   â””â”€â”€ UserRepository.java
    â”‚   â””â”€â”€ dto/
    â”‚       â””â”€â”€ response/
    â”‚           â””â”€â”€ UserResponse.java
    â”‚
    â”œâ”€â”€ order/                        # ì£¼ë¬¸ ë„ë©”ì¸
    â”‚   â”œâ”€â”€ controller/
    â”‚   â”‚   â””â”€â”€ OrderController.java
    â”‚   â”œâ”€â”€ service/
    â”‚   â”‚   â””â”€â”€ OrderService.java
    â”‚   â”œâ”€â”€ repository/
    â”‚   â”‚   â”œâ”€â”€ OrderRepository.java
    â”‚   â”‚   â””â”€â”€ OrderItemRepository.java
    â”‚   â”œâ”€â”€ entity/
    â”‚   â”‚   â”œâ”€â”€ Order.java
    â”‚   â”‚   â”œâ”€â”€ OrderItem.java
    â”‚   â”‚   â””â”€â”€ OrderStatus.java (enum)
    â”‚   â””â”€â”€ dto/
    â”‚       â”œâ”€â”€ request/
    â”‚       â”‚   â”œâ”€â”€ OrderCreateRequest.java
    â”‚       â”‚   â””â”€â”€ OrderItemRequest.java
    â”‚       â””â”€â”€ response/
    â”‚           â”œâ”€â”€ OrderResponse.java
    â”‚           â””â”€â”€ OrderItemResponse.java
    â”‚
    â”œâ”€â”€ drone/                        # ë“œë¡  ë„ë©”ì¸
    â”‚   â”œâ”€â”€ entity/
    â”‚   â”‚   â”œâ”€â”€ Drone.java
    â”‚   â”‚   â””â”€â”€ DroneStatus.java (enum)
    â”‚   â””â”€â”€ repository/
    â”‚       â””â”€â”€ DroneRepository.java
    â”‚
    â””â”€â”€ route/                        # ë°°ì†¡ ê²½ë¡œ ë„ë©”ì¸ (í•µì‹¬)
        â”œâ”€â”€ controller/
        â”‚   â””â”€â”€ RouteController.java
        â”œâ”€â”€ service/
        â”‚   â”œâ”€â”€ RouteService.java
        â”‚   â”œâ”€â”€ RouteOptimizerService.java     # TSP ì•Œê³ ë¦¬ì¦˜
        â”‚   â”œâ”€â”€ DroneSimulatorService.java     # @Async ì‹œë®¬ë ˆì´ì…˜
        â”‚   â””â”€â”€ DeliveryBatchService.java      # ë°°ì¹˜ ì²˜ë¦¬
        â”œâ”€â”€ scheduler/
        â”‚   â””â”€â”€ DeliveryScheduler.java         # @Scheduled
        â”œâ”€â”€ repository/
        â”‚   â”œâ”€â”€ RouteRepository.java
        â”‚   â”œâ”€â”€ RouteStopRepository.java
        â”‚   â”œâ”€â”€ RoutePositionRepository.java
        â”‚   â””â”€â”€ FlightLogRepository.java
        â”œâ”€â”€ entity/
        â”‚   â”œâ”€â”€ Route.java
        â”‚   â”œâ”€â”€ RouteStop.java
        â”‚   â”œâ”€â”€ RoutePosition.java
        â”‚   â”œâ”€â”€ FlightLog.java
        â”‚   â”œâ”€â”€ RouteStatus.java (enum)
        â”‚   â”œâ”€â”€ StopType.java (enum)
        â”‚   â”œâ”€â”€ StopStatus.java (enum)
        â”‚   â””â”€â”€ FlightResult.java (enum)
        â””â”€â”€ dto/
            â””â”€â”€ response/
                â”œâ”€â”€ RouteResponse.java
                â”œâ”€â”€ RouteStopResponse.java
                â””â”€â”€ DronePositionResponse.java
```

### 2.3 ê³„ì¸µë³„ ì±…ì„

| ê³„ì¸µ | ì±…ì„ | ì˜ˆì‹œ |
|------|------|------|
| **Controller** | HTTP ìš”ì²­/ì‘ë‹µ ì²˜ë¦¬, Validation | `@RestController`, `@GetMapping`, `@Valid` |
| **Service** | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, íŠ¸ëœì­ì…˜ ê´€ë¦¬ | ì¬ê³  í™•ì¸, ê±°ë¦¬ ê³„ì‚°, ê²½ë¡œ ìµœì í™” |
| **Repository** | ë°ì´í„° ì ‘ê·¼, ì¿¼ë¦¬ ì‹¤í–‰ | JPA, `@Query`, Custom Query |
| **Entity** | ë„ë©”ì¸ ëª¨ë¸, ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ | ìƒíƒœ ë³€ê²½ ë©”ì„œë“œ, ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ |
| **DTO** | ë°ì´í„° ì „ì†¡, ì‘ë‹µ ë³€í™˜ | Request/Response ê°ì²´ |

---

## 3. ê¸°ìˆ  ìŠ¤íƒ ë° ì„ íƒ ì´ìœ 

### 3.1 ë°±ì—”ë“œ í”„ë ˆì„ì›Œí¬

#### Spring Boot 3.5.7
- **ì„ íƒ ì´ìœ **:
  - ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ì•ˆì •ì„± ë° í’ë¶€í•œ ìƒíƒœê³„
  - Auto Configurationìœ¼ë¡œ ë¹ ë¥¸ ê°œë°œ
  - Spring Data JPAë¡œ ORM ê°„í¸ ì²˜ë¦¬
  - Spring WebSocketìœ¼ë¡œ ì‹¤ì‹œê°„ í†µì‹  ì§€ì›
  - Production-ready ê¸°ëŠ¥ (Actuator, Logging ë“±)

### 3.2 ë°ì´í„°ë² ì´ìŠ¤

#### MySQL 8.x
- **ì„ íƒ ì´ìœ **:
  - ê³µê°„ ë°ì´í„° í•¨ìˆ˜ ì§€ì› (Haversine ê±°ë¦¬ ê³„ì‚°)
  - íŠ¸ëœì­ì…˜ ACID ë³´ì¥
  - ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì„±ëŠ¥
  - ë„ë¦¬ ì‚¬ìš©ë˜ì–´ ë ˆí¼ëŸ°ìŠ¤ í’ë¶€
  - ë¬´ë£Œ ì˜¤í”ˆì†ŒìŠ¤

### 3.3 ORM

#### Spring Data JPA (Hibernate)
- **ì„ íƒ ì´ìœ **:
  - ê°ì²´-ê´€ê³„ ë§¤í•‘ìœ¼ë¡œ ìƒì‚°ì„± í–¥ìƒ
  - JPQLë¡œ ë³µì¡í•œ ì¿¼ë¦¬ ì²˜ë¦¬
  - Lazy Loadingìœ¼ë¡œ N+1 ë¬¸ì œ ë°©ì§€
  - ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ ì§€ì› (ê±°ë¦¬ ê³„ì‚° ë“±)

### 3.4 ì‹¤ì‹œê°„ í†µì‹ 

#### Spring WebSocket (STOMP over SockJS)
- **ì„ íƒ ì´ìœ **:
  - ì–‘ë°©í–¥ ì‹¤ì‹œê°„ í†µì‹  (ë“œë¡  ìœ„ì¹˜ ìŠ¤íŠ¸ë¦¬ë°)
  - SockJSë¡œ ë¸Œë¼ìš°ì € í˜¸í™˜ì„± ë³´ì¥
  - STOMP í”„ë¡œí† ì½œë¡œ ë©”ì‹œì§€ ë¼ìš°íŒ… ê°„í¸
  - Spring ìƒíƒœê³„ì™€ ìì—°ìŠ¤ëŸ¬ìš´ í†µí•©

### 3.5 API ë¬¸ì„œí™”

#### SpringDoc OpenAPI 3.0 (Swagger UI)
- **ì„ íƒ ì´ìœ **:
  - ì½”ë“œ ê¸°ë°˜ ìë™ ë¬¸ì„œ ìƒì„±
  - ì¸í„°ë™í‹°ë¸Œ í…ŒìŠ¤íŠ¸ UI ì œê³µ
  - Spring Boot 3.x ê³µì‹ ì§€ì›
  - í”„ë¡ íŠ¸ì—”ë“œ íŒ€ê³¼ì˜ í˜‘ì—… ë„êµ¬

### 3.6 ë¹Œë“œ ë„êµ¬

#### Gradle 8.x
- **ì„ íƒ ì´ìœ **:
  - Mavenë³´ë‹¤ ë¹ ë¥¸ ë¹Œë“œ ì†ë„
  - Groovy/Kotlin DSLë¡œ ìœ ì—°í•œ ì„¤ì •
  - Incremental Build ì§€ì›
  - Spring Initializr ê¸°ë³¸ ì œê³µ

### 3.7 ìœ í‹¸ë¦¬í‹°

#### Lombok
- **ì„ íƒ ì´ìœ **:
  - Boilerplate ì½”ë“œ ê°ì†Œ (Getter, Constructor ë“±)
  - `@Slf4j`ë¡œ ë¡œê¹… ê°„í¸í™”
  - `@Builder`ë¡œ ê°ì²´ ìƒì„± íŒ¨í„´ ì§€ì›

---

## 4. ë„ë©”ì¸ ëª¨ë¸ ì„¤ê³„

### 4.1 ë„ë©”ì¸ ê°œìš”

ì‹œìŠ¤í…œì€ 7ê°œì˜ í•µì‹¬ ë„ë©”ì¸ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Store  â”‚â—„â”€â”€â”€â”€â–ºâ”‚ Product â”‚      â”‚  User   â”‚
â”‚  (ë§¤ì¥)  â”‚      â”‚  (ìƒí’ˆ)  â”‚      â”‚(ì‚¬ìš©ì)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                â”‚                â”‚
     â”‚ owner_id       â”‚                â”‚ role:
     â”‚ (OWNER)        â”‚                â”‚ CUSTOMER
     â”‚                â–¼                â”‚ OWNER
     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚         â”‚    StoreProduct          â”‚
     â”‚         â”‚   (ë§¤ì¥ë³„ íŒë§¤ ìƒí’ˆ)        â”‚
     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚                â”‚
     â”‚ 1:N (drones)   â”‚                â”‚
     â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Drone   â”‚  â”‚        Order             â”‚â—„â”€â”€â”€â”€â–ºâ”‚   User   â”‚
â”‚ (ë“œë¡ )    â”‚  â”‚      (ì£¼ë¬¸)               â”‚      â”‚(CUSTOMER)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚               â”‚
     â”‚ N:1 (store)   â”‚ 1:N
     â”‚               â–¼
     â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚        â”‚      OrderItem           â”‚
     â”‚        â”‚    (ì£¼ë¬¸ í•­ëª©)            â”‚
     â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚               â”‚
     â”‚ 1:N           â”‚
     â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Route  â”‚   â”‚  RouteStopOrder          â”‚
â”‚(ë°°ì†¡ê²½ë¡œ)â”‚   â”‚  (ê²½ë¡œ-ì£¼ë¬¸ ë§¤í•‘)          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚               â”‚
     â”‚ 1:N           â–¼
     â–¼        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     RouteStop            â”‚
â”‚RoutePos. â”‚  â”‚     (ì •ë¥˜ì¥)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚FlightLog â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì£¼ìš” ê´€ê³„:
- Store 1:N Drone (ê° ë§¤ì¥ì€ ì—¬ëŸ¬ ë“œë¡  ë³´ìœ )
- Drone N:1 Store (ê° ë“œë¡ ì€ íŠ¹ì • ë§¤ì¥ ì†Œì†)
- Store 1:N User(OWNER) (ê° ë§¤ì¥ì€ 1ëª…ì˜ ì ì£¼ ì†Œìœ )
- Drone 1:N Route (ë“œë¡ ì€ ì—¬ëŸ¬ ë°°ì†¡ ê²½ë¡œ ìˆ˜í–‰)
```

### 4.2 ì£¼ìš” Entity ì„¤ëª…

#### Store (ë§¤ì¥)
```java
@Entity
public class Store {
    @Id @GeneratedValue
    private Long storeId;

    private String name;                    // ë§¤ì¥ëª…
    @Enumerated(EnumType.STRING)
    private StoreType type;                 // CONVENIENCE, PHARMACY, OTHER
    private BigDecimal lat;                 // ìœ„ë„ (ì†Œìˆ˜ì  6ìë¦¬)
    private BigDecimal lng;                 // ê²½ë„ (ì†Œìˆ˜ì  6ìë¦¬)
    private BigDecimal deliveryRadiusKm;    // ë°°ì†¡ ê°€ëŠ¥ ë°˜ê²½
    private Boolean isActive;               // ìš´ì˜ ì—¬ë¶€
}
```
**ì—­í• **: ë“œë¡  ë°°ì†¡ ê±°ì  (ì¶œë°œ/ë³µê·€ ì§€ì )

#### Product (ìƒí’ˆ)
```java
@Entity
public class Product {
    @Id @GeneratedValue
    private Long productId;

    private String name;                    // ìƒí’ˆëª…
    private String category;                // ì¹´í…Œê³ ë¦¬ (ìŒë£Œ, ì‹í’ˆ, ì˜ì•½í’ˆ ë“±)
    private BigDecimal unitWeightKg;        // ë‹¨ìœ„ ë¬´ê²Œ
    private Boolean requiresVerification;   // ì—°ë ¹ í™•ì¸ í•„ìš” ì—¬ë¶€
}
```
**ì—­í• **: íŒë§¤ ê°€ëŠ¥í•œ ìƒí’ˆ ë§ˆìŠ¤í„°

#### StoreProduct (ë§¤ì¥ë³„ íŒë§¤ ìƒí’ˆ)
```java
@Entity
@IdClass(StoreProductId.class)
public class StoreProduct {
    @Id @ManyToOne
    private Store store;

    @Id @ManyToOne
    private Product product;

    private Integer price;                  // íŒë§¤ê°€
    private Integer stockQty;               // ì¬ê³  ìˆ˜ëŸ‰
    private Integer maxQtyPerOrder;         // ìµœëŒ€ ì£¼ë¬¸ ìˆ˜ëŸ‰

    // ì¬ê³  ê°ì†Œ ë©”ì„œë“œ
    public void decreaseStock(int quantity) {
        this.stockQty -= quantity;
    }
}
```
**ì—­í• **: ë§¤ì¥ë§ˆë‹¤ ë‹¤ë¥¸ ê°€ê²©/ì¬ê³  ê´€ë¦¬

#### User (ì‚¬ìš©ì)
```java
@Entity
@Table(name = "user")
public class User {
    @Id @GeneratedValue
    private Long userId;

    private String name;                    // ì‚¬ìš©ìëª…
    private String phone;                   // ì „í™”ë²ˆí˜¸
    private String address;                 // ì£¼ì†Œ
    private BigDecimal lat;                 // ìœ„ë„
    private BigDecimal lng;                 // ê²½ë„

    @Enumerated(EnumType.STRING)
    private UserRole role;                  // CUSTOMER, OWNER

    private LocalDateTime registeredAt;     // ë“±ë¡ì¼ì‹œ
}
```
**ì—­í• **: ê³ ê°(CUSTOMER) ë˜ëŠ” ë§¤ì¥ ì ì£¼(OWNER)

#### Order (ì£¼ë¬¸)
```java
@Entity
@Table(name = "orders")
public class Order {
    @Id @GeneratedValue
    private Long orderId;

    @ManyToOne
    private Store store;                    // ì¶œë°œ ë§¤ì¥

    @ManyToOne
    private User user;                      // ì£¼ë¬¸ ì‚¬ìš©ì

    private BigDecimal originLat;           // ì¶œë°œì§€ ìœ„ë„
    private BigDecimal originLng;           // ì¶œë°œì§€ ê²½ë„
    private BigDecimal destLat;             // ëª©ì ì§€ ìœ„ë„
    private BigDecimal destLng;             // ëª©ì ì§€ ê²½ë„

    private BigDecimal totalWeightKg;       // ì´ ë¬´ê²Œ
    private Integer totalAmount;            // ì´ ê¸ˆì•¡
    private Integer itemCount;              // í•­ëª© ìˆ˜

    @Enumerated(EnumType.STRING)
    private OrderStatus status;             // CREATED, ASSIGNED, FULFILLED, CANCELED

    @OneToMany(mappedBy = "order", cascade = CascadeType.ALL)
    private List<OrderItem> orderItems;     // ì£¼ë¬¸ í•­ëª©ë“¤

    // ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œ
    public void assignDelivery() {
        this.status = OrderStatus.ASSIGNED;
        this.assignedAt = LocalDateTime.now();
    }
}
```
**ì—­í• **: ì‚¬ìš©ìì˜ ë°°ì†¡ ìš”ì²­ (ì£¼ë¬¸ì„œ)

#### Drone (ë“œë¡ )
```java
@Entity
public class Drone {
    @Id @GeneratedValue
    private Long droneId;

    @ManyToOne
    @JoinColumn(name = "store_id", nullable = false)
    private Store store;                    // ì†Œì† ë§¤ì¥

    private String model;                   // ëª¨ë¸ëª…
    private Integer batteryCapacity;        // ë°°í„°ë¦¬ ìš©ëŸ‰ (mAh)
    private BigDecimal maxPayloadKg;        // ìµœëŒ€ ì ì¬ëŸ‰ (kg)

    @Enumerated(EnumType.STRING)
    private DroneStatus status;             // IDLE, IN_FLIGHT, CHARGING, MAINTENANCE
}
```
**ì—­í• **: ë°°ì†¡ì„ ìˆ˜í–‰í•˜ëŠ” ë“œë¡  (ë§¤ì¥ ì†Œì†)
**ê´€ê³„**:
- N:1 Store (ê° ë“œë¡ ì€ íŠ¹ì • ë§¤ì¥ ì†Œì†)
- 1:N Route (ë“œë¡ ì€ ì—¬ëŸ¬ ë°°ì†¡ ê²½ë¡œ ìˆ˜í–‰)

#### Route (ë°°ì†¡ ê²½ë¡œ)
```java
@Entity
public class Route {
    @Id @GeneratedValue
    private Long routeId;

    @ManyToOne
    private Drone drone;                    // í• ë‹¹ëœ ë“œë¡ 

    @ManyToOne
    private Store store;                    // ì¶œë°œ/ë³µê·€ ë§¤ì¥

    @Enumerated(EnumType.STRING)
    private RouteStatus status;             // PLANNED, LAUNCHED, IN_PROGRESS, COMPLETED

    private LocalDateTime plannedStartAt;
    private LocalDateTime actualStartAt;
    private BigDecimal plannedTotalDistanceKm;  // ê³„íšëœ ì´ ê±°ë¦¬
    private String heuristic;               // ì‚¬ìš©í•œ ì•Œê³ ë¦¬ì¦˜ (ì˜ˆ: "2-opt")

    @OneToMany(mappedBy = "route", cascade = CascadeType.ALL)
    private List<RouteStop> routeStops;     // ê²½ìœ ì§€ë“¤ (PICKUP â†’ DROPë“¤ â†’ RETURN)

    @OneToMany(mappedBy = "route", cascade = CascadeType.ALL)
    private List<RoutePosition> routePositions;  // ìœ„ì¹˜ ê¸°ë¡ë“¤
}
```
**ì—­í• **: í•œ ë²ˆì˜ ë“œë¡  ì¶œê²© ì„ë¬´

#### RouteStop (ê²½ë¡œ ì •ë¥˜ì¥)
```java
@Entity
public class RouteStop {
    @Id @GeneratedValue
    private Long stopId;

    @ManyToOne
    private Route route;

    private Integer stopSeq;                // ìˆœì„œ (1, 2, 3, ...)

    @Enumerated(EnumType.STRING)
    private StopType type;                  // PICKUP, DROP, RETURN

    @Enumerated(EnumType.STRING)
    private StopStatus status;              // PENDING, ARRIVED, DEPARTED

    private BigDecimal lat;
    private BigDecimal lng;

    @ManyToOne
    private Store store;                    // PICKUP/RETURNì¸ ê²½ìš°

    @ManyToOne
    private User user;                      // DROPì¸ ê²½ìš°
}
```
**ì—­í• **: ê²½ë¡œìƒì˜ ê° ì •ë¥˜ì¥ (í”½ì—… â†’ ë°°ì†¡1 â†’ ë°°ì†¡2 â†’ ... â†’ ë³µê·€)

#### RoutePosition (ë“œë¡  ìœ„ì¹˜)
```java
@Entity
public class RoutePosition {
    @Id @GeneratedValue
    private Long posId;

    @ManyToOne
    private Route route;

    private BigDecimal lat;                 // í˜„ì¬ ìœ„ë„
    private BigDecimal lng;                 // í˜„ì¬ ê²½ë„
    private BigDecimal speedMps;            // ì†ë„ (m/s)
    private BigDecimal batteryPct;          // ë°°í„°ë¦¬ ì”ëŸ‰ (%)

    private LocalDateTime ts;               // ì¸¡ì • ì‹œê°
}
```
**ì—­í• **: ë“œë¡ ì˜ ì‹¤ì‹œê°„ ìœ„ì¹˜ ì €ì¥ (2ì´ˆë§ˆë‹¤ INSERT)

---

## 5. í•µì‹¬ ê¸°ëŠ¥ ìƒì„¸

### 5.1 ì£¼ë³€ ë§¤ì¥ ì¡°íšŒ

#### íë¦„ë„
```
ì‚¬ìš©ì ìœ„ì¹˜ (ìœ„ë„, ê²½ë„)
      â†“
[StoreController]
  GET /api/stores?lat=37.5665&lng=126.9780&radius=5.0
      â†“
[StoreService.getStoresNearby()]
      â†“
[StoreRepository.findStoresWithinRadius()]
  âœ“ Native Queryë¡œ Haversine ê±°ë¦¬ ê³„ì‚°
  âœ“ ë°˜ê²½ ë‚´ ë§¤ì¥ë§Œ í•„í„°ë§
  âœ“ ê±°ë¦¬ ìˆœ ì •ë ¬
      â†“
[GeoUtils.calculateDistance()]
  ê° ë§¤ì¥ê¹Œì§€ì˜ ì •í™•í•œ ê±°ë¦¬ ê³„ì‚°
      â†“
List<StoreResponse> ë°˜í™˜
  (ë§¤ì¥ ì •ë³´ + ì‚¬ìš©ìë¡œë¶€í„°ì˜ ê±°ë¦¬)
```

#### í•µì‹¬ ì½”ë“œ

**Repository (Native Query)**
```java
@Query(value = """
    SELECT s.* FROM store s
    WHERE s.is_active = 1
    AND (6371 * acos(
        cos(radians(:lat)) * cos(radians(s.lat)) *
        cos(radians(s.lng) - radians(:lng)) +
        sin(radians(:lat)) * sin(radians(s.lat))
    )) <= :radiusKm
    ORDER BY (...)
    """, nativeQuery = true)
List<Store> findStoresWithinRadius(
    @Param("lat") BigDecimal lat,
    @Param("lng") BigDecimal lng,
    @Param("radiusKm") BigDecimal radiusKm
);
```

**Haversine ê³µì‹ (GeoUtils)**
```java
public static double calculateDistance(
    double lat1, double lng1,
    double lat2, double lng2
) {
    double dLat = Math.toRadians(lat2 - lat1);
    double dLng = Math.toRadians(lng2 - lng1);

    double a = Math.sin(dLat / 2) * Math.sin(dLat / 2)
             + Math.cos(Math.toRadians(lat1))
             * Math.cos(Math.toRadians(lat2))
             * Math.sin(dLng / 2) * Math.sin(dLng / 2);

    double c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

    return 6371.0 * c;  // km
}
```

**ì •í™•ë„**: ì†Œìˆ˜ì  6ìë¦¬ (Â±0.11m ì˜¤ì°¨)

---

### 5.2 ì£¼ë¬¸ ìƒì„± ë° ì¬ê³  ê´€ë¦¬

#### íë¦„ë„
```
ì‚¬ìš©ì ì¥ë°”êµ¬ë‹ˆ
      â†“
[OrderController]
  POST /api/orders
  RequestBody: {
    storeId: 1,
    userId: 1,
    items: [{productId: 1, quantity: 2}, ...]
  }
      â†“
[OrderService.createOrder()]

  1ï¸âƒ£ ë§¤ì¥ ì¡´ì¬ ë° í™œì„±í™” í™•ì¸
     â””â”€ ì—†ìœ¼ë©´ STORE_NOT_FOUND ì˜ˆì™¸

  2ï¸âƒ£ ì‚¬ìš©ì ì¡´ì¬ í™•ì¸
     â””â”€ ì—†ìœ¼ë©´ USER_NOT_FOUND ì˜ˆì™¸

  3ï¸âƒ£ ì£¼ë¬¸ í•­ëª© ê²€ì¦
     â””â”€ ë¹„ì–´ìˆìœ¼ë©´ ORDER_ITEMS_EMPTY ì˜ˆì™¸

  4ï¸âƒ£ ê° ìƒí’ˆë³„ ê²€ì¦ (Loop)
     â”œâ”€ StoreProduct ì¡°íšŒ (í•´ë‹¹ ë§¤ì¥ì—ì„œ íŒë§¤í•˜ëŠ”ê°€?)
     â”œâ”€ ì¬ê³  í™•ì¸ (stockQty >= quantity?)
     â”‚  â””â”€ ë¶€ì¡±í•˜ë©´ PRODUCT_OUT_OF_STOCK ì˜ˆì™¸
     â”œâ”€ ìµœëŒ€ ìˆ˜ëŸ‰ í™•ì¸ (quantity <= maxQtyPerOrder?)
     â”‚  â””â”€ ì´ˆê³¼í•˜ë©´ PRODUCT_EXCEED_MAX_QUANTITY ì˜ˆì™¸
     â””â”€ ì´ ë¬´ê²Œ/ê¸ˆì•¡ ê³„ì‚°

  5ï¸âƒ£ Order ìƒì„±
     â”œâ”€ originLat/Lng â† Store ìœ„ì¹˜
     â”œâ”€ destLat/Lng â† User ìœ„ì¹˜
     â”œâ”€ totalWeightKg, totalAmount, itemCount
     â””â”€ status = CREATED

  6ï¸âƒ£ OrderItem ìƒì„± ë° ì¶”ê°€

  7ï¸âƒ£ â­ ì¬ê³  ì°¨ê°
     â””â”€ storeProduct.decreaseStock(quantity)

  8ï¸âƒ£ íŠ¸ëœì­ì…˜ ì»¤ë°‹
      â†“
OrderCreateResponse ë°˜í™˜
```

#### íŠ¸ëœì­ì…˜ ê´€ë¦¬

```java
@Service
@Transactional  // â† ì „ì²´ ë©”ì„œë“œê°€ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜
public class OrderService {

    @Transactional
    public OrderResponse createOrder(OrderCreateRequest request) {
        // ... ê²€ì¦ ë¡œì§ ...

        // ì¬ê³  ì°¨ê° (ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬)
        for (OrderItemRequest item : request.getItems()) {
            StoreProduct sp = storeProductRepository.findById(...);
            sp.decreaseStock(item.getQuantity());  // â† UPDATE ì¿¼ë¦¬ ìë™ ìƒì„±
        }

        // Order ì €ì¥
        Order saved = orderRepository.save(order);

        return OrderResponse.from(saved);
        // â† ì—¬ê¸°ì„œ íŠ¸ëœì­ì…˜ ì»¤ë°‹ (ì¬ê³  ê°ì†Œ í™•ì •)
    }
}
```

**ACID ë³´ì¥**:
- **Atomicity**: ì£¼ë¬¸ ìƒì„±ê³¼ ì¬ê³  ì°¨ê°ì´ ëª¨ë‘ ì„±ê³µí•˜ê±°ë‚˜ ëª¨ë‘ ì‹¤íŒ¨
- **Consistency**: ì¬ê³ ëŠ” í•­ìƒ 0 ì´ìƒ (CHECK ì œì•½ì¡°ê±´)
- **Isolation**: ë™ì‹œì— ê°™ì€ ìƒí’ˆ ì£¼ë¬¸ ì‹œ ê²©ë¦¬ ìˆ˜ì¤€ì— ë”°ë¼ ì²˜ë¦¬
- **Durability**: ì»¤ë°‹ í›„ ë°ì´í„°ë² ì´ìŠ¤ì— ì˜êµ¬ ì €ì¥

---

### 5.3 ê²½ë¡œ ìµœì í™” (TSP ì•Œê³ ë¦¬ì¦˜)

#### ë¬¸ì œ ì •ì˜

**ì…ë ¥**:
- ì¶œë°œì§€: ë§¤ì¥ (lat, lng)
- ë°°ì†¡ì§€ë“¤: Nê°œì˜ ê³ ê° ìœ„ì¹˜
- ë³µê·€ì§€: ë™ì¼í•œ ë§¤ì¥

**ëª©í‘œ**: ì´ ì´ë™ ê±°ë¦¬ë¥¼ ìµœì†Œí™”í•˜ëŠ” ë°©ë¬¸ ìˆœì„œ ì°¾ê¸°

#### ì•Œê³ ë¦¬ì¦˜: Nearest Neighbor (NN) íœ´ë¦¬ìŠ¤í‹±

```java
@Service
public class RouteOptimizerService {

    public List<Order> optimizeRoute(
        List<Order> orders,
        Store store
    ) {
        List<Order> optimized = new ArrayList<>();
        List<Order> unvisited = new ArrayList<>(orders);

        // í˜„ì¬ ìœ„ì¹˜ = ë§¤ì¥
        double currentLat = store.getLat().doubleValue();
        double currentLng = store.getLng().doubleValue();

        // ëª¨ë“  ë°°ì†¡ì§€ ë°©ë¬¸í•  ë•Œê¹Œì§€ ë°˜ë³µ
        while (!unvisited.isEmpty()) {
            Order nearest = null;
            double minDistance = Double.MAX_VALUE;

            // í˜„ì¬ ìœ„ì¹˜ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ ë°°ì†¡ì§€ ì°¾ê¸°
            for (Order order : unvisited) {
                double distance = GeoUtils.calculateDistance(
                    currentLat, currentLng,
                    order.getDestLat().doubleValue(),
                    order.getDestLng().doubleValue()
                );

                if (distance < minDistance) {
                    minDistance = distance;
                    nearest = order;
                }
            }

            // ê°€ì¥ ê°€ê¹Œìš´ ê³³ì„ ë‹¤ìŒ ë°©ë¬¸ì§€ë¡œ ì„ íƒ
            optimized.add(nearest);
            unvisited.remove(nearest);

            // í˜„ì¬ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
            currentLat = nearest.getDestLat().doubleValue();
            currentLng = nearest.getDestLng().doubleValue();
        }

        return optimized;  // ìµœì í™”ëœ ìˆœì„œ
    }
}
```

#### ì‹œê°„ ë³µì¡ë„

- **Nearest Neighbor**: O(NÂ²)
- N = ë°°ì†¡ì§€ ê°œìˆ˜ (ì¼ë°˜ì ìœ¼ë¡œ 10ê°œ ì´í•˜)
- ì‹¤ì‹œê°„ ì²˜ë¦¬ ê°€ëŠ¥í•œ ìˆ˜ì¤€

#### ê°œì„  ê°€ëŠ¥í•œ ì•Œê³ ë¦¬ì¦˜

| ì•Œê³ ë¦¬ì¦˜ | ì‹œê°„ ë³µì¡ë„ | ì •í™•ë„ | ë¹„ê³  |
|---------|-----------|--------|------|
| Nearest Neighbor | O(NÂ²) | ê·¼ì‚¬í•´ | í˜„ì¬ êµ¬í˜„ |
| 2-opt | O(NÂ²) | ë” ë‚˜ì€ ê·¼ì‚¬í•´ | ì¶”í›„ ê³ ë„í™” |
| Genetic Algorithm | O(N Ã— G) | ë§¤ìš° ì¢‹ìŒ | G = ì„¸ëŒ€ ìˆ˜ |
| Exact (DP) | O(2á´º Ã— NÂ²) | ìµœì í•´ | Nâ‰¤20 ì •ë„ë§Œ ê°€ëŠ¥ |

---

### 5.4 ë“œë¡  ì‹œë®¬ë ˆì´í„°

#### ëª©ì 
ì‹¤ì œ ë“œë¡  ì—†ì´ ë°ëª¨ë¥¼ ìœ„í•´ ë“œë¡  ë¹„í–‰ì„ ì‹œë®¬ë ˆì´ì…˜í•˜ê³ , ì‹¤ì‹œê°„ìœ¼ë¡œ ìœ„ì¹˜ë¥¼ ì¶”ì  ê°€ëŠ¥í•˜ê²Œ í•¨

#### ë¹„ë™ê¸° ì‹¤í–‰ êµ¬ì¡°

```java
@Service
@EnableAsync  // â† Main Applicationì— ì„¤ì •
public class DroneSimulatorService {

    private final SimpMessagingTemplate messagingTemplate;  // WebSocket

    @Async  // â† ë³„ë„ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰
    public void simulateFlight(Long routeId) {
        Route route = routeRepository.findByIdWithDetails(routeId)
            .orElseThrow(() -> new BaseException(ErrorCode.ROUTE_NOT_FOUND));

        // 1. ê²½ë¡œ ìƒíƒœ ë³€ê²½
        route.changeStatus(RouteStatus.LAUNCHED);
        route.setActualStartAt(LocalDateTime.now());

        List<RouteStop> stops = route.getRouteStops();

        // 2. ê° êµ¬ê°„ ìˆœíšŒ
        for (int i = 0; i < stops.size() - 1; i++) {
            RouteStop from = stops.get(i);
            RouteStop to = stops.get(i + 1);

            // 3. êµ¬ê°„ ì‹œë®¬ë ˆì´ì…˜ (2ì´ˆë§ˆë‹¤ ìœ„ì¹˜ ì—…ë°ì´íŠ¸)
            simulateSegment(route, from, to);
        }

        // 4. ê²½ë¡œ ì™„ë£Œ
        route.changeStatus(RouteStatus.COMPLETED);
        route.setActualEndAt(LocalDateTime.now());

        // 5. FlightLog ìƒì„±
        createFlightLog(route);
    }

    private void simulateSegment(Route route, RouteStop from, RouteStop to) {
        double startLat = from.getLat().doubleValue();
        double startLng = from.getLng().doubleValue();
        double endLat = to.getLat().doubleValue();
        double endLng = to.getLng().doubleValue();

        // ê±°ë¦¬ ê³„ì‚°
        double distance = GeoUtils.calculateDistance(
            startLat, startLng, endLat, endLng
        );

        // ì†Œìš” ì‹œê°„ ê³„ì‚° (í‰ê·  ì†ë„ 30km/h = 8.33m/s)
        double durationSeconds = (distance * 1000) / 8.33;
        int steps = (int) (durationSeconds / 2);  // 2ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸

        // ì„ í˜• ë³´ê°„ìœ¼ë¡œ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        for (int step = 0; step <= steps; step++) {
            double fraction = (double) step / steps;  // 0.0 ~ 1.0

            double[] position = GeoUtils.interpolate(
                startLat, startLng,
                endLat, endLng,
                fraction
            );

            // RoutePosition ì €ì¥
            RoutePosition rp = RoutePosition.builder()
                .route(route)
                .lat(new BigDecimal(position[0]))
                .lng(new BigDecimal(position[1]))
                .speedMps(new BigDecimal(8.33))
                .batteryPct(new BigDecimal(100 - (step * 0.5)))
                .build();
            routePositionRepository.save(rp);

            // WebSocketìœ¼ë¡œ ë¸Œë¡œë“œìºìŠ¤íŠ¸
            DronePositionResponse response = DronePositionResponse.from(rp);
            messagingTemplate.convertAndSend(
                "/topic/route/" + route.getRouteId(),
                response
            );

            // 2ì´ˆ ëŒ€ê¸°
            Thread.sleep(2000);
        }

        // ëª©ì ì§€ ë„ì°©
        to.arrive();  // status = ARRIVED
    }
}
```

#### ì„ í˜• ë³´ê°„ (Linear Interpolation)

```java
public static double[] interpolate(
    double lat1, double lng1,
    double lat2, double lng2,
    double fraction  // 0.0 ~ 1.0
) {
    double lat = lat1 + (lat2 - lat1) * fraction;
    double lng = lng1 + (lng2 - lng1) * fraction;
    return new double[]{lat, lng};
}
```

**ì˜ˆì‹œ**:
- ì‹œì‘: (37.5000, 127.0300)
- ì¢…ë£Œ: (37.5050, 127.0350)
- fraction = 0.5 (50% ì§€ì )
- ê²°ê³¼: (37.5025, 127.0325)

---

### 5.5 ë°°ì¹˜ ì²˜ë¦¬ ë° ìŠ¤ì¼€ì¤„ë§

#### ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì •

```java
@Component
@Slf4j
public class DeliveryScheduler {

    @Scheduled(cron = "0 */10 * * * *")  // ë§¤ 10ë¶„ë§ˆë‹¤
    public void scheduleBatch() {
        log.info("ë°°ì†¡ ë°°ì¹˜ ì²˜ë¦¬ ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘");
        deliveryBatchService.processBatch();
        log.info("ë°°ì†¡ ë°°ì¹˜ ì²˜ë¦¬ ìŠ¤ì¼€ì¤„ëŸ¬ ì™„ë£Œ");
    }
}
```

**Cron í‘œí˜„ì‹**: `"0 */10 * * * *"`
- ì´ˆ: 0
- ë¶„: */10 (ë§¤ 10ë¶„ë§ˆë‹¤ - 0, 10, 20, 30, 40, 50)
- ì‹œ: * (ëª¨ë“  ì‹œ)
- ì¼: * (ëª¨ë“  ë‚ )
- ì›”: * (ëª¨ë“  ì›”)
- ìš”ì¼: * (ëª¨ë“  ìš”ì¼)

#### ë°°ì¹˜ ì²˜ë¦¬ ë¡œì§

```java
@Service
@Transactional
public class DeliveryBatchService {

    public void processBatch() {
        // 1. CREATED ìƒíƒœì˜ ì£¼ë¬¸ë“¤ ì¡°íšŒ
        List<Order> pendingOrders =
            orderRepository.findByStatus(OrderStatus.CREATED);

        if (pendingOrders.isEmpty()) {
            log.info("ì²˜ë¦¬í•  ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        // 2. ë§¤ì¥ë³„ë¡œ ê·¸ë£¹í™”
        Map<Long, List<Order>> groupedByStore = pendingOrders.stream()
            .collect(Collectors.groupingBy(order -> order.getStore().getStoreId()));

        // 3. ê° ë§¤ì¥ë³„ë¡œ ì²˜ë¦¬
        for (Map.Entry<Long, List<Order>> entry : groupedByStore.entrySet()) {
            Long storeId = entry.getKey();
            List<Order> orders = entry.getValue();

            try {
                processStoreDeliveries(storeId, orders);
            } catch (Exception e) {
                log.error("ë§¤ì¥ {} ë°°ì†¡ ì²˜ë¦¬ ì‹¤íŒ¨", storeId, e);
            }
        }
    }

    private void processStoreDeliveries(Long storeId, List<Order> orders) {
        // 1. ë§¤ì¥ ì¡°íšŒ
        Store store = storeRepository.findById(storeId)
            .orElseThrow(() -> new BaseException(ErrorCode.STORE_NOT_FOUND));

        // 2. í•´ë‹¹ ë§¤ì¥ì˜ ëŒ€ê¸° ì¤‘ì¸ ë“œë¡  ì¡°íšŒ
        Drone drone = droneRepository.findFirstByStoreAndStatus(store, DroneStatus.IDLE)
            .orElseThrow(() -> new BaseException(ErrorCode.DRONE_NOT_AVAILABLE));

        // 3. ê²½ë¡œ ìµœì í™”
        List<Order> optimizedOrders =
            routeOptimizerService.optimizeRoute(orders, store);

        // 4. Route ìƒì„±
        Route route = Route.builder()
            .drone(drone)
            .store(store)
            .status(RouteStatus.PLANNED)
            .heuristic("Nearest Neighbor")
            .build();
        routeRepository.save(route);

        // 5. RouteStop ìƒì„±
        int seq = 1;

        // 5-1. PICKUP (ë§¤ì¥ì—ì„œ ë¬¼ê±´ ì‹£ê¸°)
        RouteStop pickup = RouteStop.builder()
            .route(route)
            .stopSeq(seq++)
            .type(StopType.PICKUP)
            .name(store.getName())
            .lat(store.getLat())
            .lng(store.getLng())
            .store(store)
            .build();
        routeStopRepository.save(pickup);

        // 5-2. DROPë“¤ (ê° ê³ ê°ì—ê²Œ ë°°ì†¡)
        for (Order order : optimizedOrders) {
            RouteStop drop = RouteStop.builder()
                .route(route)
                .stopSeq(seq++)
                .type(StopType.DROP)
                .name(order.getUser().getName())
                .lat(order.getDestLat())
                .lng(order.getDestLng())
                .user(order.getUser())
                .build();
            routeStopRepository.save(drop);

            // ì£¼ë¬¸ ìƒíƒœ ë³€ê²½
            order.assignDelivery();  // CREATED â†’ ASSIGNED
        }

        // 5-3. RETURN (ë§¤ì¥ìœ¼ë¡œ ë³µê·€)
        RouteStop returnStop = RouteStop.builder()
            .route(route)
            .stopSeq(seq)
            .type(StopType.RETURN)
            .name(store.getName())
            .lat(store.getLat())
            .lng(store.getLng())
            .store(store)
            .build();
        routeStopRepository.save(returnStop);

        // 6. ë“œë¡  ìƒíƒœ ë³€ê²½
        drone.changeStatus(DroneStatus.IN_FLIGHT);

        // 7. ë“œë¡  ì‹œë®¬ë ˆì´í„° ì‹œì‘ (ë¹„ë™ê¸°)
        droneSimulatorService.simulateFlight(route.getRouteId());

        log.info("ë§¤ì¥ {} ë°°ì†¡ ê²½ë¡œ ìƒì„± ì™„ë£Œ: {} ê±´", storeId, requests.size());
    }
}
```

#### ì‹¤í–‰ ì˜ˆì‹œ

```
[10:00:00] ë°°ì†¡ ë°°ì¹˜ ì²˜ë¦¬ ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘
[10:00:01] CREATED ìƒíƒœ ì£¼ë¬¸ 5ê±´ ì¡°íšŒ
[10:00:01] ë§¤ì¥ë³„ ê·¸ë£¹í™”: {1: [ì£¼ë¬¸1, ì£¼ë¬¸2, ì£¼ë¬¸3], 2: [ì£¼ë¬¸4, ì£¼ë¬¸5]}
[10:00:02] ë§¤ì¥ 1 ì²˜ë¦¬ ì‹œì‘
[10:00:02] ëŒ€ê¸° ì¤‘ì¸ ë“œë¡  í• ë‹¹: Drone#1
[10:00:03] ê²½ë¡œ ìµœì í™” ì™„ë£Œ: ì£¼ë¬¸1 â†’ ì£¼ë¬¸3 â†’ ì£¼ë¬¸2
[10:00:04] Route#1 ìƒì„± (5ê°œ Stop: PICKUP â†’ DROP Ã— 3 â†’ RETURN)
[10:00:05] ë“œë¡  ì‹œë®¬ë ˆì´í„° ì‹œì‘ (ë¹„ë™ê¸°)
[10:00:05] ë§¤ì¥ 1 ë°°ì†¡ ê²½ë¡œ ìƒì„± ì™„ë£Œ: 3ê±´
[10:00:06] ë§¤ì¥ 2 ì²˜ë¦¬ ì‹œì‘
...
[10:00:15] ë°°ì†¡ ë°°ì¹˜ ì²˜ë¦¬ ìŠ¤ì¼€ì¤„ëŸ¬ ì™„ë£Œ
```

---

## 6. API ëª…ì„¸

### 6.1 ê³µí†µ ì‘ë‹µ í˜•ì‹

ëª¨ë“  APIëŠ” `BaseResponse<T>` í˜•ì‹ì„ ë”°ë¦…ë‹ˆë‹¤.

#### ì„±ê³µ ì‘ë‹µ
```json
{
  "success": true,
  "data": {
    // ì‹¤ì œ ë°ì´í„°
  },
  "error": null
}
```

#### ì‹¤íŒ¨ ì‘ë‹µ
```json
{
  "success": false,
  "data": null,
  "error": {
    "code": "S001",
    "message": "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë§¤ì¥ì…ë‹ˆë‹¤."
  }
}
```

### 6.2 ë§¤ì¥ API

#### 1. ì£¼ë³€ ë§¤ì¥ ì¡°íšŒ

**ìš”ì²­**
```http
GET /api/stores?lat=37.5665&lng=126.9780&radius=5.0
```

**íŒŒë¼ë¯¸í„°**
| ì´ë¦„ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|------|------|
| lat | BigDecimal | O | ì‚¬ìš©ì ìœ„ë„ | 37.5665 |
| lng | BigDecimal | O | ì‚¬ìš©ì ê²½ë„ | 126.9780 |
| radius | BigDecimal | X | ê²€ìƒ‰ ë°˜ê²½ (km) | 5.0 (ê¸°ë³¸ê°’) |

**ì‘ë‹µ**
```json
{
  "success": true,
  "data": [
    {
      "storeId": 1,
      "name": "ì„¸ë¸ì¼ë ˆë¸ ê°•ë‚¨ì ",
      "type": "CONVENIENCE",
      "phone": "02-1234-5678",
      "address": "ì„œìš¸ ê°•ë‚¨êµ¬",
      "lat": 37.5000,
      "lng": 127.0300,
      "deliveryRadiusKm": 3.00,
      "distanceKm": 1.25
    }
  ],
  "error": null
}
```

#### 2. ë§¤ì¥ ì¹´í…Œê³ ë¦¬ ëª©ë¡

**ìš”ì²­**
```http
GET /api/stores/1/categories
```

**ì‘ë‹µ**
```json
{
  "success": true,
  "data": [
    {"category": "ìŒë£Œ"},
    {"category": "ì‹í’ˆ"},
    {"category": "ì˜ì•½í’ˆ"}
  ],
  "error": null
}
```

#### 3. ë§¤ì¥ ìƒí’ˆ ëª©ë¡

**ìš”ì²­**
```http
GET /api/stores/1/products?category=ìŒë£Œ
```

**íŒŒë¼ë¯¸í„°**
| ì´ë¦„ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|------|------|------|------|
| category | String | X | ì¹´í…Œê³ ë¦¬ (ì—†ìœ¼ë©´ ì „ì²´) |

**ì‘ë‹µ**
```json
{
  "success": true,
  "data": [
    {
      "productId": 1,
      "name": "ì½œë¼ 500ml",
      "category": "ìŒë£Œ",
      "unitWeightKg": 0.550,
      "price": 1500,
      "stockQty": 100,
      "maxQtyPerOrder": 10
    }
  ],
  "error": null
}
```

### 6.3 ì£¼ë¬¸ API

#### 1. ì£¼ë¬¸ ìƒì„±

**ìš”ì²­**
```http
POST /api/orders
Content-Type: application/json

{
  "storeId": 1,
  "userId": 1,
  "items": [
    {
      "productId": 1,
      "quantity": 2
    },
    {
      "productId": 2,
      "quantity": 1
    }
  ],
  "note": "ë¹ ë¥¸ ë°°ì†¡ ë¶€íƒë“œë¦½ë‹ˆë‹¤."
}
```

**ì‘ë‹µ (201 Created)**
```json
{
  "orderId": 1
}
        "unitWeightKg": 0.550,
        "subtotal": 3000
      },
      {
        "requestItemId": 2,
        "productId": 2,
        "productName": "ì‚¼ê°ê¹€ë°¥",
        "quantity": 1,
        "unitPrice": 1200,
        "unitWeightKg": 0.120,
        "subtotal": 1200
      }
    ],
    "note": "ë¹ ë¥¸ ë°°ì†¡ ë¶€íƒë“œë¦½ë‹ˆë‹¤."
  },
  "error": null
}
```

#### 2. ì£¼ë¬¸ ì¡°íšŒ

**ìš”ì²­**
```http
GET /api/orders/1
```

**ì‘ë‹µ**
```json
{
  "success": true,
  "data": {
    "requestId": 1,
    "status": "ASSIGNED",
    "assignedAt": "2025-11-20T14:40:00",
    // ... (ë‚˜ë¨¸ì§€ ë™ì¼)
  },
  "error": null
}
```

### 6.4 ë°°ì†¡ ê²½ë¡œ API

#### 1. ë°°ì†¡ ê²½ë¡œ ì¡°íšŒ

**ìš”ì²­**
```http
GET /api/routes/1
```

**ì‘ë‹µ**
```json
{
  "success": true,
  "data": {
    "routeId": 1,
    "droneId": 1,
    "droneModel": "DJI Matrice 300",
    "storeId": 1,
    "storeName": "ì„¸ë¸ì¼ë ˆë¸ ê°•ë‚¨ì ",
    "status": "IN_PROGRESS",
    "createdAt": "2025-11-20T14:40:00",
    "launchedAt": "2025-11-20T14:40:05",
    "totalDistanceKm": 5.23,
    "totalWeightKg": 3.450,
    "estimatedDurationMin": 15,
    "stops": [
      {
        "stopId": 1,
        "stopSeq": 1,
        "type": "PICKUP",
        "name": "ì„¸ë¸ì¼ë ˆë¸ ê°•ë‚¨ì ",
        "lat": 37.5000,
        "lng": 127.0300,
        "status": "DEPARTED",
        "arrivedAt": "2025-11-20T14:40:05",
        "departedAt": "2025-11-20T14:41:00"
      },
      {
        "stopId": 2,
        "stopSeq": 2,
        "type": "DROP",
        "name": "í™ê¸¸ë™",
        "lat": 37.5050,
        "lng": 127.0350,
        "status": "ARRIVED",
        "arrivedAt": "2025-11-20T14:43:00"
      },
      // ... ë‚˜ë¨¸ì§€ Stopë“¤
    ]
  },
  "error": null
}
```

#### 2. ë“œë¡  í˜„ì¬ ìœ„ì¹˜ ì¡°íšŒ

**ìš”ì²­**
```http
GET /api/routes/1/current-position
```

**ì‘ë‹µ**
```json
{
  "success": true,
  "data": {
    "routeId": 1,
    "lat": 37.5025,
    "lng": 127.0325,
    "altitudeM": 50.0,
    "speedKmh": 30.0,
    "battery": 95,
    "recordedAt": "2025-11-20T14:42:30"
  },
  "error": null
}
```

#### 3. ì§„í–‰ ì¤‘ì¸ ë°°ì†¡ ëª©ë¡

**ìš”ì²­**
```http
GET /api/routes/active
```

**ì‘ë‹µ**
```json
{
  "success": true,
  "data": [
    {
      "routeId": 1,
      "status": "IN_PROGRESS",
      // ... (routeId=1 ìƒì„¸ ì •ë³´)
    },
    {
      "routeId": 2,
      "status": "LAUNCHED",
      // ... (routeId=2 ìƒì„¸ ì •ë³´)
    }
  ],
  "error": null
}
```

### 6.5 ì—ëŸ¬ ì½”ë“œ

| ì½”ë“œ | HTTP ìƒíƒœ | ë©”ì‹œì§€ |
|------|----------|--------|
| C001 | 400 | ì˜ëª»ëœ ì…ë ¥ê°’ì…ë‹ˆë‹¤. |
| C002 | 405 | ì§€ì›í•˜ì§€ ì•ŠëŠ” HTTP ë©”ì„œë“œì…ë‹ˆë‹¤. |
| C003 | 500 | ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. |
| **S001** | 404 | ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë§¤ì¥ì…ë‹ˆë‹¤. |
| **S002** | 400 | ìš´ì˜ ì¤‘ì´ì§€ ì•Šì€ ë§¤ì¥ì…ë‹ˆë‹¤. |
| **P001** | 404 | ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìƒí’ˆì…ë‹ˆë‹¤. |
| **P003** | 400 | ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. |
| **P004** | 400 | ìµœëŒ€ ì£¼ë¬¸ ìˆ˜ëŸ‰ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. |
| **CU001** | 404 | ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³ ê°ì…ë‹ˆë‹¤. |
| **O001** | 404 | ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì£¼ë¬¸ì…ë‹ˆë‹¤. |
| **O004** | 400 | ì£¼ë¬¸ í•­ëª©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. |
| **D002** | 400 | ì‚¬ìš© ê°€ëŠ¥í•œ ë“œë¡ ì´ ì—†ìŠµë‹ˆë‹¤. |
| **R001** | 404 | ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë°°ì†¡ ê²½ë¡œì…ë‹ˆë‹¤. |
| **R005** | 404 | ë“œë¡  ìœ„ì¹˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. |

---

## 7. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### 7.1 ERD (Entity Relationship Diagram)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     STORE       â”‚
â”‚  (ë§¤ì¥)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK store_id     â”‚
â”‚    name         â”‚
â”‚    type         â”‚â—„â”€â”€â”€â”€â”€â”€â”
â”‚    lat, lng     â”‚       â”‚
â”‚    delivery_    â”‚       â”‚
â”‚    radius_km    â”‚       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
     â”‚                    â”‚
     â”‚ 1                  â”‚
     â”‚                    â”‚ N
     â”‚ N          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼            â”‚  STORE_PRODUCT   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  (ë§¤ì¥ë³„ íŒë§¤ìƒí’ˆ) â”‚
â”‚    PRODUCT      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  (ìƒí’ˆ)          â”‚â—„â”€PK,FK store_id  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—„â”€PK,FK product_idâ”‚
â”‚ PK product_id   â”‚    price         â”‚
â”‚    name         â”‚    stock_qty     â”‚
â”‚    category     â”‚    max_qty_per_  â”‚
â”‚    unit_weight_ â”‚    order         â”‚
â”‚    kg           â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚         ORDER                   â”‚  â”‚
â”‚        (ì£¼ë¬¸)                    â”‚  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ PK order_id                     â”‚  â”‚
â”‚ FK store_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”˜
â”‚ FK user_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚    origin_lat/lng   â”‚           â”‚
â”‚    dest_lat/lng     â”‚           â”‚
â”‚    total_weight_kg  â”‚           â”‚
â”‚    total_amount     â”‚           â”‚
â”‚    status           â”‚           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
     â”‚                            â”‚
     â”‚ 1                          â”‚ 1
     â”‚                            â”‚
     â”‚ N                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
     â–¼                  â”‚      USER      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    (ì‚¬ìš©ì)     â”‚
â”‚  ORDER_ITEM      â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  (ì£¼ë¬¸ í•­ëª©)      â”‚    â”‚ PK user_id     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚    name        â”‚
â”‚ PK order_item_id â”‚    â”‚    phone       â”‚
â”‚ FK order_id      â”‚    â”‚    address     â”‚
â”‚ FK product_id    â”‚    â”‚    lat, lng    â”‚
â”‚    quantity      â”‚    â”‚    role        â”‚
â”‚    unit_price    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ROUTE_STOP        â”‚        â”‚     DRONE       â”‚
â”‚    (ì •ë¥˜ì¥)           â”‚        â”‚    (ë“œë¡ )        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK stop_id           â”‚        â”‚ PK drone_id     â”‚
â”‚ FK route_id          â”‚â—„â”€â”€â”€â”   â”‚ FK store_id â”€â”€â”€â”€â”¼â”€â”€â”
â”‚    stop_seq          â”‚    â”‚   â”‚    model        â”‚  â”‚
â”‚    type              â”‚    â”‚   â”‚    battery_     â”‚  â”‚
â”‚    name              â”‚    â”‚   â”‚    capacity     â”‚  â”‚
â”‚    lat, lng          â”‚    â”‚   â”‚    max_payload_ â”‚  â”‚
â”‚    status            â”‚    â”‚   â”‚    kg           â”‚  â”‚
â”‚ FK store_id (opt)    â”‚    â”‚   â”‚    status       â”‚  â”‚
â”‚ FK user_id (opt)     â”‚    â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ FK order_id          â”‚    â”‚        â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚        â”‚ 1             â”‚
                            â”‚        â”‚               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚ N             â”‚
       â”‚                    â”‚        â”‚               â”‚
       â”‚ N                  â”‚ 1      â”‚               â”‚
       â”‚                    â”‚        â”‚               â”‚
       â–¼                    â–¼        â–¼               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚            ROUTE                     â”‚             â”‚
â”‚          (ë°°ì†¡ ê²½ë¡œ)                  â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚ PK route_id                          â”‚             â”‚
â”‚ FK drone_id                          â”‚             â”‚
â”‚ FK store_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚    status                            â”‚
â”‚    planned_start_at                  â”‚
â”‚    actual_start_at                   â”‚
â”‚    planned_total_distance_km         â”‚
â”‚    heuristic                         â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                      â”‚
    â”‚ 1                    â”‚ 1
    â”‚                      â”‚
    â”‚ N                    â”‚ N
    â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ROUTE_POSITIONâ”‚    â”‚ FLIGHT_LOG â”‚
â”‚(ë“œë¡  ìœ„ì¹˜)    â”‚    â”‚ (ë¹„í–‰ ë¡œê·¸) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚PK pos_id     â”‚    â”‚PK log_id   â”‚
â”‚FK route_id   â”‚    â”‚FK route_id â”‚
â”‚  lat, lng    â”‚    â”‚FK drone_id â”‚
â”‚  speed_mps   â”‚    â”‚  start_timeâ”‚
â”‚  battery_pct â”‚    â”‚  end_time  â”‚
â”‚  ts          â”‚    â”‚  distance  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  result    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ì£¼ìš” í…Œì´ë¸” ì„¤ëª…

#### store (ë§¤ì¥)
- **ì—­í• **: ë“œë¡  ë°°ì†¡ ê±°ì  (ì¶œë°œ/ë³µê·€ ì§€ì )
- **ì¸ë±ìŠ¤**: (lat, lng) ê³µê°„ ê²€ìƒ‰ ìµœì í™”
- **íŠ¹ì§•**: `delivery_radius_km`ë¡œ ë°°ì†¡ ê°€ëŠ¥ ë°˜ê²½ ì •ì˜

#### store_product (ë§¤ì¥ë³„ íŒë§¤ ìƒí’ˆ)
- **ì—­í• **: ë§¤ì¥ë§ˆë‹¤ ë‹¤ë¥¸ ê°€ê²©/ì¬ê³  ê´€ë¦¬
- **ë³µí•© í‚¤**: (store_id, product_id)
- **íŠ¹ì§•**: `stock_qty`ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¦ê°

#### order (ì£¼ë¬¸)
- **ì—­í• **: ê³ ê°ì˜ ì£¼ë¬¸ì„œ
- **ìƒíƒœ**: CREATED â†’ ASSIGNED â†’ FULFILLED
- **íŠ¹ì§•**: `origin_*`ëŠ” Store, `dest_*`ëŠ” User

#### route (ë°°ì†¡ ê²½ë¡œ)
- **ì—­í• **: í•œ ë²ˆì˜ ë“œë¡  ì¶œê²© ì„ë¬´
- **íŠ¹ì§•**: RouteStopë“¤ì˜ ì»¨í…Œì´ë„ˆ ì—­í• 
- **ìƒíƒœ**: PLANNED â†’ LAUNCHED â†’ IN_PROGRESS â†’ COMPLETED

#### route_stop (ì •ë¥˜ì¥)
- **ì—­í• **: ê²½ë¡œìƒì˜ ê° ì§€ì 
- **íƒ€ì…**: PICKUP (í”½ì—…) â†’ DROPë“¤ (ë°°ì†¡) â†’ RETURN (ë³µê·€)
- **ìˆœì„œ**: `stop_seq`ë¡œ ë°©ë¬¸ ìˆœì„œ ë³´ì¥

#### route_position (ë“œë¡  ìœ„ì¹˜)
- **ì—­í• **: ë“œë¡ ì˜ ì‹¤ì‹œê°„ ìœ„ì¹˜ ê¸°ë¡
- **íŠ¹ì§•**: 2ì´ˆë§ˆë‹¤ INSERT, `ts`ë¡œ ì‹œê³„ì—´ ë°ì´í„°
- **ì¸ë±ìŠ¤**: (route_id, ts) ìµœì‹  ìœ„ì¹˜ ë¹ ë¥¸ ì¡°íšŒ

### 7.3 ì¸ë±ìŠ¤ ì „ëµ

```sql
-- ê±°ë¦¬ ê¸°ë°˜ ê²€ìƒ‰ ìµœì í™”
CREATE INDEX ix_store_location ON store(lat, lng);

-- ìƒíƒœë³„ ë¹ ë¥¸ ì¡°íšŒ
CREATE INDEX ix_dr_status ON drone(status);
CREATE INDEX ix_order_status ON `order`(status);
CREATE INDEX ix_route_status ON route(status);

-- ë§¤ì¥ë³„ ì£¼ë¬¸ ì¡°íšŒ
CREATE INDEX ix_order_store_status ON `order`(store_id, status);

-- ìµœì‹  ìœ„ì¹˜ ì¡°íšŒ ìµœì í™”
CREATE INDEX ix_rp_route_ts ON route_position(route_id, ts);

-- ê²½ë¡œì˜ ì •ë¥˜ì¥ ìˆœì„œ ì¡°íšŒ
CREATE INDEX ix_rs_route_seq ON route_stop(route_id, stop_seq);
```

### 7.4 ì œì•½ ì¡°ê±´

```sql
-- ìœ„ê²½ë„ ë²”ìœ„ ê²€ì¦
CONSTRAINT chk_store_lat CHECK (lat BETWEEN -90 AND 90)
CONSTRAINT chk_store_lng CHECK (lng BETWEEN -180 AND 180)

-- ì¬ê³  ìŒìˆ˜ ë°©ì§€
CONSTRAINT chk_qty_nonneg CHECK (stock_qty >= 0)

-- ê°€ê²© ìŒìˆ˜ ë°©ì§€
CONSTRAINT chk_price_nonneg CHECK (price >= 0)

-- ë“œë¡  ì ì¬ëŸ‰ ì–‘ìˆ˜ ë³´ì¥
CONSTRAINT chk_payload_pos CHECK (max_payload_kg > 0)
```

---

## 8. ì‹¤ì‹œê°„ í†µì‹  êµ¬ì¡°

### 8.1 WebSocket ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React Client  â”‚
â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SockJS   â”‚  â”‚
â”‚  â”‚  Client   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ WebSocket Connection
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Spring Boot Backend           â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  WebSocketConfig          â”‚ â”‚
â”‚  â”‚  - enableSimpleBroker     â”‚ â”‚
â”‚  â”‚  - setApplicationDest...  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚               â”‚                 â”‚
â”‚               â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Message Broker           â”‚ â”‚
â”‚  â”‚  Topic: /topic/route/{id} â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          â”‚                     â”‚
â”‚          â”‚ subscribe           â”‚
â”‚          â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  DroneSimulatorService    â”‚ â”‚
â”‚  â”‚  - messagingTemplate      â”‚ â”‚
â”‚  â”‚  - convertAndSend()       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 STOMP í”„ë¡œí† ì½œ

#### ì—°ê²° ì„¤ì •

**í´ë¼ì´ì–¸íŠ¸ (JavaScript)**
```javascript
// SockJS + STOMP ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš”
const socket = new SockJS('http://localhost:8080/ws');
const stompClient = Stomp.over(socket);

stompClient.connect({}, function(frame) {
    console.log('ì—°ê²° ì„±ê³µ:', frame);

    // íŠ¹ì • ê²½ë¡œ êµ¬ë…
    const routeId = 1;
    stompClient.subscribe('/topic/route/' + routeId, function(message) {
        const position = JSON.parse(message.body);
        console.log('ë“œë¡  ìœ„ì¹˜ ì—…ë°ì´íŠ¸:', position);

        // ì§€ë„ì— ë§ˆì»¤ ì—…ë°ì´íŠ¸
        updateDroneMarker(position.lat, position.lng);
    });
});
```

**ì„œë²„ (Spring Boot)**
```java
@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {

    @Override
    public void configureMessageBroker(MessageBrokerRegistry config) {
        // í´ë¼ì´ì–¸íŠ¸ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ë•Œ prefix
        config.enableSimpleBroker("/topic");

        // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ë•Œ prefix
        config.setApplicationDestinationPrefixes("/app");
    }

    @Override
    public void registerStompEndpoints(StompEndpointRegistry registry) {
        registry.addEndpoint("/ws")
                .setAllowedOrigins("http://localhost:3000", "http://localhost:5173")
                .withSockJS();  // SockJS í´ë°± ì§€ì›
    }
}
```

#### ë©”ì‹œì§€ ì „ì†¡

**ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ (ë¸Œë¡œë“œìºìŠ¤íŠ¸)**
```java
@Service
public class DroneSimulatorService {

    private final SimpMessagingTemplate messagingTemplate;

    public void sendPosition(Long routeId, DronePositionResponse position) {
        messagingTemplate.convertAndSend(
            "/topic/route/" + routeId,  // í† í”½
            position                     // ë©”ì‹œì§€ (ìë™ JSON ë³€í™˜)
        );
    }
}
```

### 8.3 ë©”ì‹œì§€ íë¦„

```
1. ë“œë¡  ì‹œë®¬ë ˆì´í„° ì‹œì‘
   DroneSimulatorService.simulateFlight(routeId=1)

2. 2ì´ˆë§ˆë‹¤ ìœ„ì¹˜ ê³„ì‚°
   double[] position = GeoUtils.interpolate(...)

3. RoutePosition ì €ì¥
   routePositionRepository.save(rp)

4. WebSocketìœ¼ë¡œ ë¸Œë¡œë“œìºìŠ¤íŠ¸
   messagingTemplate.convertAndSend(
     "/topic/route/1",
     DronePositionResponse.from(rp)
   )

5. êµ¬ë… ì¤‘ì¸ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬
   Client A â”€â”€â”
   Client B â”€â”€â”¼â”€â–º { lat: 37.5025, lng: 127.0325, ... }
   Client C â”€â”€â”˜

6. í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì§€ë„ ì—…ë°ì´íŠ¸
   updateDroneMarker(position.lat, position.lng)
```

### 8.4 í† í”½ êµ¬ì¡°

| í† í”½ | ì„¤ëª… | êµ¬ë…ì | ë°œí–‰ì |
|------|------|--------|--------|
| `/topic/route/{routeId}` | íŠ¹ì • ê²½ë¡œì˜ ë“œë¡  ìœ„ì¹˜ | í•´ë‹¹ ê²½ë¡œë¥¼ ì¶”ì í•˜ëŠ” ì‚¬ìš©ìë“¤ | DroneSimulatorService |

**ì˜ˆì‹œ**:
- `/topic/route/1`: Route ID=1ì˜ ë“œë¡  ìœ„ì¹˜
- `/topic/route/2`: Route ID=2ì˜ ë“œë¡  ìœ„ì¹˜

### 8.5 ì—°ê²° í•´ì œ ì²˜ë¦¬

```javascript
// í˜ì´ì§€ ì´íƒˆ ì‹œ ì—°ê²° í•´ì œ
window.addEventListener('beforeunload', function() {
    if (stompClient !== null) {
        stompClient.disconnect(function() {
            console.log('WebSocket ì—°ê²° í•´ì œ');
        });
    }
});
```

---

## 9. ë°°ì¹˜ ì²˜ë¦¬ ë° ìŠ¤ì¼€ì¤„ë§

### 9.1 ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì •

```java
@Configuration
@EnableScheduling  // â† ìŠ¤ì¼€ì¤„ë§ í™œì„±í™”
public class SchedulerConfig {
}
```

### 9.2 Cron í‘œí˜„ì‹

```
"0 */10 * * * *"
 â”‚  â”‚   â”‚ â”‚ â”‚ â”‚
 â”‚  â”‚   â”‚ â”‚ â”‚ â””â”€ ìš”ì¼ (0-7, 0ê³¼ 7ì€ ì¼ìš”ì¼)
 â”‚  â”‚   â”‚ â”‚ â””â”€â”€â”€ ì›” (1-12)
 â”‚  â”‚   â”‚ â””â”€â”€â”€â”€â”€ ì¼ (1-31)
 â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€ ì‹œ (0-23)
 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë¶„ (0-59) */10 = ë§¤ 10ë¶„ë§ˆë‹¤
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì´ˆ (0-59)
```

**ì‹¤í–‰ ì‹œê°**:
- ë§¤ ì‹œê°„ 0ë¶„, 10ë¶„, 20ë¶„, 30ë¶„, 40ë¶„, 50ë¶„
- ì˜ˆ: 09:00, 09:10, 09:20, ..., 23:50, 00:00

### 9.3 ë°°ì¹˜ ì²˜ë¦¬ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DeliveryScheduler                          â”‚
â”‚              @Scheduled(cron = "0 */10 * * * *")         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ ë§¤ 10ë¶„ë§ˆë‹¤
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         DeliveryBatchService.processBatch()             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. CREATED ìƒíƒœ ì£¼ë¬¸ ì¡°íšŒ                                â”‚
â”‚     â””â”€ SELECT * FROM `order`                             â”‚
â”‚        WHERE status = 'CREATED'                          â”‚
â”‚                                                          â”‚
â”‚  2. ë§¤ì¥ë³„ ê·¸ë£¹í™”                                          â”‚
â”‚     â””â”€ Map<StoreId, List<Order>>                         â”‚
â”‚                                                          â”‚
â”‚  3. ê° ë§¤ì¥ë³„ ì²˜ë¦¬ (Loop)                                  â”‚
â”‚     â”œâ”€ í•´ë‹¹ ë§¤ì¥ì˜ ëŒ€ê¸° ì¤‘ì¸ ë“œë¡  ì¡°íšŒ                      â”‚
â”‚     â”‚  â””â”€ SELECT * FROM drone                            â”‚
â”‚     â”‚     WHERE store_id = ? AND status = 'IDLE'         â”‚
â”‚     â”‚     LIMIT 1                                        â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ ê²½ë¡œ ìµœì í™” (TSP)                                  â”‚
â”‚     â”‚  â””â”€ RouteOptimizerService.optimizeRoute()         â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ Route ìƒì„±                                        â”‚
â”‚     â”‚  â””â”€ INSERT INTO route ...                         â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ RouteStop ìƒì„± (PICKUP â†’ DROPë“¤ â†’ RETURN)         â”‚
â”‚     â”‚  â””â”€ INSERT INTO route_stop ...                    â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ Order ìƒíƒœ ë³€ê²½                                   â”‚
â”‚     â”‚  â””â”€ UPDATE `order`                                â”‚
â”‚     â”‚     SET status = 'ASSIGNED' ...                   â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ Drone ìƒíƒœ ë³€ê²½                                   â”‚
â”‚     â”‚  â””â”€ UPDATE drone SET status = 'IN_FLIGHT' ...     â”‚
â”‚     â”‚                                                    â”‚
â”‚     â””â”€ ë“œë¡  ì‹œë®¬ë ˆì´í„° ì‹œì‘ (@Async)                       â”‚
â”‚        â””â”€ DroneSimulatorService.simulateFlight()        â”‚
â”‚                                                          â”‚
â”‚  4. íŠ¸ëœì­ì…˜ ì»¤ë°‹                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.4 ë™ì‹œì„± ì œì–´

#### ë¬¸ì œ: ê°™ì€ ë“œë¡ ì„ ì—¬ëŸ¬ ê²½ë¡œì— í• ë‹¹?

```java
// âŒ ë¬¸ì œ ìƒí™©
// ìŠ¤ë ˆë“œ A: ë“œë¡ #1 ì¡°íšŒ â†’ IDLE í™•ì¸
// ìŠ¤ë ˆë“œ B: ë“œë¡ #1 ì¡°íšŒ â†’ IDLE í™•ì¸ (ë™ì‹œ)
// ìŠ¤ë ˆë“œ A: ë“œë¡ #1 â†’ IN_FLIGHT ë³€ê²½
// ìŠ¤ë ˆë“œ B: ë“œë¡ #1 â†’ IN_FLIGHT ë³€ê²½ (ì¤‘ë³µ í• ë‹¹!)
```

#### í•´ê²°ì±… 1: Pessimistic Lock (ë¹„ê´€ì  ë½)

```java
@Lock(LockModeType.PESSIMISTIC_WRITE)
@Query("SELECT d FROM Drone d WHERE d.status = 'IDLE'")
Optional<Drone> findFirstIdleDroneWithLock();

// SELECT ... FROM drone WHERE status = 'IDLE' FOR UPDATE
```

#### í•´ê²°ì±… 2: Optimistic Lock (ë‚™ê´€ì  ë½)

```java
@Entity
public class Drone {
    @Version
    private Long version;  // â† ë²„ì „ í•„ë“œ
}

// UPDATE drone SET status = ?, version = version + 1
// WHERE drone_id = ? AND version = ?
```

#### í•´ê²°ì±… 3: Scheduled Lock (í˜„ì¬ êµ¬í˜„)

```java
@Scheduled(cron = "0 */10 * * * *")
@SchedulerLock(name = "deliveryBatch", lockAtMostFor = "9m", lockAtLeastFor = "1m")
public void scheduleBatch() {
    // ShedLock ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© ì‹œ
    // ì—¬ëŸ¬ ì„œë²„ê°€ ìˆì–´ë„ í•˜ë‚˜ë§Œ ì‹¤í–‰ë¨
}
```

---

## 10. ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ

### 10.1 ì˜ˆì™¸ ê³„ì¸µ êµ¬ì¡°

```
Throwable
  â””â”€ Exception
      â”œâ”€ RuntimeException
      â”‚   â”œâ”€ BaseException (ì»¤ìŠ¤í…€)
      â”‚   â”‚   â”œâ”€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì˜ˆì™¸
      â”‚   â”‚   â””â”€ ErrorCode í¬í•¨
      â”‚   â”‚
      â”‚   â”œâ”€ IllegalArgumentException
      â”‚   â”œâ”€ IllegalStateException
      â”‚   â””â”€ ...
      â”‚
      â””â”€ Checked Exceptions
          â”œâ”€ IOException
          â”œâ”€ SQLException
          â””â”€ ...
```

### 10.2 BaseException êµ¬ì¡°

```java
@Getter
public class BaseException extends RuntimeException {
    private final ErrorCode errorCode;

    public BaseException(ErrorCode errorCode) {
        super(errorCode.getMessage());
        this.errorCode = errorCode;
    }
}

// ì‚¬ìš© ì˜ˆì‹œ
if (store == null) {
    throw new BaseException(ErrorCode.STORE_NOT_FOUND);
}
```

### 10.3 ErrorCode Enum

```java
@Getter
@RequiredArgsConstructor
public enum ErrorCode {
    // format: (HTTP Status, ì—ëŸ¬ ì½”ë“œ, ë©”ì‹œì§€)

    // Common (C)
    INVALID_INPUT_VALUE(HttpStatus.BAD_REQUEST, "C001", "ì˜ëª»ëœ ì…ë ¥ê°’ì…ë‹ˆë‹¤."),

    // Store (S)
    STORE_NOT_FOUND(HttpStatus.NOT_FOUND, "S001", "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë§¤ì¥ì…ë‹ˆë‹¤."),

    // Product (P)
    PRODUCT_OUT_OF_STOCK(HttpStatus.BAD_REQUEST, "P003", "ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),

    // ... (ì´ 60+ ì—ëŸ¬ ì½”ë“œ)

    private final HttpStatus status;
    private final String code;
    private final String message;
}
```

### 10.4 GlobalExceptionHandler

```java
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

    /**
     * ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì˜ˆì™¸
     */
    @ExceptionHandler(BaseException.class)
    protected ResponseEntity<BaseResponse<Void>> handleBaseException(BaseException e) {
        log.error("BaseException: code={}, message={}",
            e.getErrorCode().getCode(), e.getMessage());

        return ResponseEntity
            .status(e.getErrorCode().getStatus())
            .body(BaseResponse.error(e.getErrorCode()));
    }

    /**
     * Validation ì˜ˆì™¸ (@Valid)
     */
    @ExceptionHandler(MethodArgumentNotValidException.class)
    protected ResponseEntity<BaseResponse<Void>> handleValidationException(
        MethodArgumentNotValidException e
    ) {
        String errorMessage = e.getBindingResult()
            .getAllErrors().get(0)
            .getDefaultMessage();

        return ResponseEntity
            .status(HttpStatus.BAD_REQUEST)
            .body(BaseResponse.error(ErrorCode.INVALID_INPUT_VALUE, errorMessage));
    }

    /**
     * ê·¸ ì™¸ ëª¨ë“  ì˜ˆì™¸
     */
    @ExceptionHandler(Exception.class)
    protected ResponseEntity<BaseResponse<Void>> handleException(Exception e) {
        log.error("Unexpected Exception: ", e);

        return ResponseEntity
            .status(HttpStatus.INTERNAL_SERVER_ERROR)
            .body(BaseResponse.error(ErrorCode.INTERNAL_SERVER_ERROR));
    }
}
```

### 10.5 ì˜ˆì™¸ ì²˜ë¦¬ íë¦„

```
Controller
   â”‚
   â”‚ @Valid ê²€ì¦ ì‹¤íŒ¨
   â”œâ”€â–º MethodArgumentNotValidException
   â”‚   â””â”€â–º GlobalExceptionHandler
   â”‚       â””â”€â–º BaseResponse.error(C001, "ìˆ˜ëŸ‰ì€ 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.")
   â”‚
   â”‚ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í˜¸ì¶œ
   â–¼
Service
   â”‚
   â”‚ ì¬ê³  ë¶€ì¡± ë°œê²¬
   â””â”€â–º throw new BaseException(ErrorCode.PRODUCT_OUT_OF_STOCK)
       â””â”€â–º GlobalExceptionHandler
           â””â”€â–º BaseResponse.error(P003, "ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.")
               â””â”€â–º HTTP 400 Bad Request
```

---

## 11. ì„±ëŠ¥ ìµœì í™”

### 11.1 N+1 ë¬¸ì œ í•´ê²°

#### ë¬¸ì œ ìƒí™©
```java
// âŒ N+1 ë°œìƒ
List<Order> orders = orderRepository.findAll();

for (Order order : orders) {
    String storeName = order.getStore().getName();  // â† SELECT ì¿¼ë¦¬ Në²ˆ ì¶”ê°€ ì‹¤í–‰
}
```

#### í•´ê²° ë°©ë²•: Fetch Join

```java
// âœ… Fetch Join ì‚¬ìš©
@Query("SELECT o FROM Order o " +
       "JOIN FETCH o.store " +
       "JOIN FETCH o.user " +
       "WHERE o.status = :status " +
       "ORDER BY o.store.storeId, o.createdAt")
List<Order> findPendingOrdersWithStoreAndUser(@Param("status") OrderStatus status);

// ë‹¨ 1ë²ˆì˜ JOIN ì¿¼ë¦¬ë¡œ ëª¨ë“  ë°ì´í„° ì¡°íšŒ
```

### 11.2 Lazy Loading í™œìš©

```java
@Entity
public class Route {
    @ManyToOne(fetch = FetchType.LAZY)  // â† ì§€ì—° ë¡œë”©
    private Drone drone;

    @OneToMany(mappedBy = "route", fetch = FetchType.LAZY)
    private List<RouteStop> routeStops;
}

// drone, routeStopsëŠ” ì‹¤ì œ ì‚¬ìš©í•  ë•Œë§Œ ì¡°íšŒ
```

### 11.3 ì¸ë±ìŠ¤ í™œìš©

```sql
-- ìƒíƒœë³„ ì¡°íšŒ ë¹ˆë²ˆ
CREATE INDEX ix_order_status ON `order`(status);

-- ë§¤ì¥ë³„ + ìƒíƒœë³„ ì¡°íšŒ
CREATE INDEX ix_order_store_status ON `order`(store_id, status);

-- ê²½ë¡œì˜ ìµœì‹  ìœ„ì¹˜ ì¡°íšŒ
CREATE INDEX ix_rp_route_ts ON route_position(route_id, ts);
```

**ì¿¼ë¦¬ ì‹¤í–‰ ê³„íš í™•ì¸**:
```sql
EXPLAIN SELECT * FROM `order` WHERE status = 'CREATED';
-- type: ref (ì¸ë±ìŠ¤ ì‚¬ìš©)
-- key: ix_order_status
```

### 11.4 ë°°ì¹˜ INSERT ìµœì í™”

```yaml
spring:
  jpa:
    properties:
      hibernate:
        jdbc:
          batch_size: 50  # â† 50ê°œì”© ë¬¶ì–´ì„œ INSERT
        order_inserts: true
        order_updates: true
```

**íš¨ê³¼**:
```sql
-- âŒ Before: Në²ˆì˜ INSERT
INSERT INTO route_position VALUES (...)
INSERT INTO route_position VALUES (...)
...

-- âœ… After: Batch INSERT
INSERT INTO route_position VALUES (...), (...), ..., (...)  -- 50ê°œì”©
```

### 11.5 Connection Pool ì„¤ì •

```yaml
spring:
  datasource:
    hikari:
      maximum-pool-size: 10     # ìµœëŒ€ ì—°ê²° ìˆ˜
      minimum-idle: 5           # ìµœì†Œ ìœ íœ´ ì—°ê²°
      connection-timeout: 30000 # 30ì´ˆ
      idle-timeout: 600000      # 10ë¶„
```

---

## 12. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 12.1 í˜„ì¬ êµ¬í˜„ (ë°ëª¨ìš©)

- âœ… CORS ì„¤ì •: React ì•±ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥
- âœ… SQL Injection ë°©ì§€: JPA Parameterized Query
- âœ… Input Validation: `@Valid`, `@NotNull`, `@Min` ë“±
- âœ… Exception Handling: ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ìˆ¨ê¹€ (í”„ë¡œë•ì…˜)

### 12.2 ì‹¤ì œ í”„ë¡œë•ì…˜ ì‹œ í•„ìš”í•œ ë³´ì•ˆ

#### 1. ì¸ì¦/ì¸ê°€
```java
// Spring Security ë„ì…
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) {
        return http
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/api/orders/**").authenticated()
                .requestMatchers("/api/stores/**").permitAll()
            )
            .oauth2Login()  // ë˜ëŠ” JWT
            .build();
    }
}
```

#### 2. API Rate Limiting
```java
// Bucket4j ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
@RateLimiter(name = "orderApi", fallbackMethod = "rateLimitFallback")
public OrderResponse createOrder(OrderCreateRequest request) {
    // ...
}
```

#### 3. HTTPS ê°•ì œ
```yaml
server:
  ssl:
    enabled: true
    key-store: classpath:keystore.p12
    key-store-password: changeit
```

#### 4. ë¯¼ê° ì •ë³´ ì•”í˜¸í™”
```java
// Jasypt ë¼ì´ë¸ŒëŸ¬ë¦¬
spring:
  datasource:
    password: ENC(encrypted_password_here)
```

---

## 13. í…ŒìŠ¤íŠ¸ ì „ëµ

### 13.1 í…ŒìŠ¤íŠ¸ í”¼ë¼ë¯¸ë“œ

```
          /\
         /  \        E2E Tests (5%)
        /â”€â”€â”€â”€\
       /      \      Integration Tests (15%)
      /â”€â”€â”€â”€â”€â”€â”€â”€\
     /          \    Unit Tests (80%)
    /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
```

### 13.2 Unit Test ì˜ˆì‹œ

```java
@ExtendWith(MockitoExtension.class)
class OrderServiceTest {

    @Mock
    private StoreRepository storeRepository;

    @Mock
    private StoreProductRepository storeProductRepository;

    @InjectMocks
    private OrderService orderService;

    @Test
    @DisplayName("ì¬ê³  ë¶€ì¡± ì‹œ ì£¼ë¬¸ ìƒì„± ì‹¤íŒ¨")
    void createOrder_OutOfStock_ThrowsException() {
        // given
        Store store = Store.builder()
            .storeId(1L)
            .isActive(true)
            .build();

        StoreProduct sp = StoreProduct.builder()
            .stockQty(5)  // ì¬ê³  5ê°œ
            .build();

        OrderItemRequest item = OrderItemRequest.builder()
            .productId(1L)
            .quantity(10)  // 10ê°œ ì£¼ë¬¸
            .build();

        when(storeRepository.findById(1L)).thenReturn(Optional.of(store));
        when(storeProductRepository.findById(...)).thenReturn(Optional.of(sp));

        // when & then
        assertThatThrownBy(() -> orderService.createOrder(request))
            .isInstanceOf(BaseException.class)
            .hasFieldOrPropertyWithValue("errorCode", ErrorCode.PRODUCT_OUT_OF_STOCK);
    }
}
```

### 13.3 Integration Test ì˜ˆì‹œ

```java
@SpringBootTest
@AutoConfigureMockMvc
class StoreControllerIntegrationTest {

    @Autowired
    private MockMvc mockMvc;

    @Test
    @DisplayName("ì£¼ë³€ ë§¤ì¥ ì¡°íšŒ API í…ŒìŠ¤íŠ¸")
    void getNearbyStores() throws Exception {
        mockMvc.perform(get("/api/stores")
                .param("lat", "37.5665")
                .param("lng", "126.9780")
                .param("radius", "5.0"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.success").value(true))
            .andExpect(jsonPath("$.data").isArray())
            .andExpect(jsonPath("$.data[0].storeId").exists());
    }
}
```

---

## 14. ë°°í¬ ê°€ì´ë“œ

### 14.1 ë¹Œë“œ

```bash
# JAR íŒŒì¼ ìƒì„±
./gradlew build

# ìƒì„± ìœ„ì¹˜
# build/libs/database-project-0.0.1-SNAPSHOT.jar
```

### 14.2 ì‹¤í–‰

```bash
# ê°œë°œ í™˜ê²½
java -jar build/libs/database-project-0.0.1-SNAPSHOT.jar

# í”„ë¡œë•ì…˜ (í”„ë¡œíŒŒì¼ ì§€ì •)
java -jar -Dspring.profiles.active=prod database-project-0.0.1-SNAPSHOT.jar
```

### 14.3 í™˜ê²½ ë³€ìˆ˜

```bash
# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
export DB_URL=jdbc:mysql://prod-db:3306/drone_delivery
export DB_USERNAME=app_user
export DB_PASSWORD=secure_password

# ì‹¤í–‰
java -jar app.jar
```

### 14.4 Docker (ì„ íƒì‚¬í•­)

**Dockerfile**
```dockerfile
FROM openjdk:17-jdk-slim
WORKDIR /app
COPY build/libs/database-project-0.0.1-SNAPSHOT.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

**docker-compose.yml**
```yaml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "8080:8080"
    environment:
      - DB_URL=jdbc:mysql://db:3306/drone_delivery
    depends_on:
      - db

  db:
    image: mysql:8.0
    environment:
      MYSQL_DATABASE: drone_delivery
      MYSQL_ROOT_PASSWORD: root_password
    ports:
      - "3306:3306"
```

---

## 15. ê²°ë¡ 

### 15.1 í”„ë¡œì íŠ¸ ì„±ê³¼

âœ… **ë„ë©”ì¸ ì¤‘ì‹¬ ì„¤ê³„**ë¡œ ìœ ì§€ë³´ìˆ˜ì„± í™•ë³´
âœ… **TSP ì•Œê³ ë¦¬ì¦˜**ìœ¼ë¡œ ì‹¤ìš©ì ì¸ ê²½ë¡œ ìµœì í™”
âœ… **WebSocket**ìœ¼ë¡œ ì‹¤ì‹œê°„ ë“œë¡  ì¶”ì  êµ¬í˜„
âœ… **Swagger**ë¡œ 100% API ë¬¸ì„œí™”
âœ… **ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬**ë¡œ ì¼ê´€ëœ ì—ëŸ¬ ì‘ë‹µ
âœ… **ìŠ¤ì¼€ì¤„ëŸ¬**ë¡œ ìë™í™”ëœ ë°°ì†¡ ë°°ì¹˜ ì²˜ë¦¬

### 15.2 í–¥í›„ ê°œì„  ë°©í–¥

ğŸ”§ **ì•Œê³ ë¦¬ì¦˜ ê³ ë„í™”**: 2-opt, Genetic Algorithm
ğŸ”§ **ì‹¤ì‹œê°„ ì¬ê³  ì•Œë¦¼**: WebSocketìœ¼ë¡œ ì¬ê³  ë¶€ì¡± ì‹œ ì•Œë¦¼
ğŸ”§ **ë“œë¡  ë°°í„°ë¦¬ ê´€ë¦¬**: ë°°í„°ë¦¬ ì†Œëª¨ ì˜ˆì¸¡ ë° ì¶©ì „ ìŠ¤ì¼€ì¤„ë§
ğŸ”§ **ë‚ ì”¨ ì—°ë™**: ê¸°ìƒì²­ APIë¡œ ì•…ì²œí›„ ì‹œ ë°°ì†¡ ì¤‘ë‹¨
ğŸ”§ **í†µê³„ ëŒ€ì‹œë³´ë“œ**: ë°°ì†¡ ì„±ê³µë¥ , í‰ê·  ë°°ì†¡ ì‹œê°„ ë“±
ğŸ”§ **Push ì•Œë¦¼**: FCMìœ¼ë¡œ ë°°ì†¡ ìƒíƒœ ë³€ê²½ ì•Œë¦¼

### 15.3 í•™ìŠµ í¬ì¸íŠ¸

- ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„ (DDD) ì‹¤ìŠµ
- TSP ì•Œê³ ë¦¬ì¦˜ì˜ ì‹¤ìš©ì  ì ìš©
- WebSocketì„ í†µí•œ ì‹¤ì‹œê°„ í†µì‹ 
- Spring Schedulerë¥¼ ì´ìš©í•œ ë°°ì¹˜ ì²˜ë¦¬
- JPA ì„±ëŠ¥ ìµœì í™” (N+1, Fetch Join, Index)
- Swaggerë¥¼ í†µí•œ API ë¬¸ì„œ ìë™í™”

---

## ë¶€ë¡

### A. ì°¸ê³  ìë£Œ

- [Spring Boot Documentation](https://docs.spring.io/spring-boot/docs/current/reference/html/)
- [Spring Data JPA Documentation](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/)
- [SpringDoc OpenAPI Documentation](https://springdoc.org/)
- [Haversine Formula](https://en.wikipedia.org/wiki/Haversine_formula)
- [Traveling Salesman Problem](https://en.wikipedia.org/wiki/Travelling_salesman_problem)

### B. ìš©ì–´ ì‚¬ì „

| ìš©ì–´ | ì„¤ëª… |
|------|------|
| TSP | Traveling Salesman Problem (ìˆœíšŒ íŒë§¤ì› ë¬¸ì œ) |
| Haversine | êµ¬ë©´ìƒì˜ ë‘ ì  ì‚¬ì´ ê±°ë¦¬ë¥¼ ê³„ì‚°í•˜ëŠ” ê³µì‹ |
| STOMP | Simple Text Oriented Messaging Protocol |
| SockJS | WebSocket fallback ë¼ì´ë¸ŒëŸ¬ë¦¬ |
| CORS | Cross-Origin Resource Sharing |
| JPA | Java Persistence API |
| DTO | Data Transfer Object |
| Cron | ì‹œê°„ ê¸°ë°˜ ìŠ¤ì¼€ì¤„ëŸ¬ í‘œí˜„ì‹ |

---

**ë¬¸ì„œ ë²„ì „**: 1.0
**ì‘ì„±ì¼**: 2025-11-20
**ì‘ì„±ì**: Development Team
